<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DESPERTAR ESTELAR: FUGA OU SALVAÇÃO</title>
    <style>
        /* Todo o CSS permanece o mesmo */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        body {
            background-color: #000;
            color: #00ff00;
            overflow: hidden;
            touch-action: manipulation;
            height: 100vh;
            width: 100vw;
        }

        /* TELAS PRINCIPAIS */
        .screen {
            position: absolute;
            height: 100vh;
            width: 100vw;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1s;
            padding: 20px;
            overflow: hidden;
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* TELA INICIAL */
        #start-screen {
            background-image: url('imagem/space.jpg');
            background-size: cover;
            background-position: center;
            z-index: 10;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .star {
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }

        @keyframes twinkle {
            0%, 100% {
                opacity: 0.5;
            }
            50% {
                opacity: 1;
            }
        }

        .title {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-align: center;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
            letter-spacing: 3px;
            animation: pulse 3s infinite;
            max-width: 90%;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 10px;
        }

        @keyframes pulse {
            0%, 100% {
                text-shadow: 0 0 10px #00ff00;
            }
            50% {
                text-shadow: 0 0 20px #00ff00, 0 0 30px #00ff00;
            }
        }

        .start-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }

        .start-button {
            padding: 15px 40px;
            font-size: 1.5rem;
            background-color: rgba(0, 0, 0, 0.7);
            color: #00ff00;
            border: 2px solid #00ff00;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            width: 250px;
            text-align: center;
        }

        .start-button:hover, .start-button:active {
            background-color: #00ff00;
            color: #000;
            box-shadow: 0 0 20px #00ff00;
        }

        .space-ship {
            position: absolute;
            width: 100px;
            height: 50px;
            animation: flyAround 30s linear infinite;
            opacity: 0.7;
            z-index: 5;
        }

        @keyframes flyAround {
            0% {
                transform: translate(-150px, 100px) rotate(30deg);
            }
            25% {
                transform: translate(calc(100vw + 50px), 30vh) rotate(-15deg);
            }
            50% {
                transform: translate(calc(100vw - 50px), calc(100vh - 100px)) rotate(-45deg);
            }
            75% {
                transform: translate(0, calc(100vh - 50px)) rotate(0deg);
            }
            100% {
                transform: translate(-150px, 100px) rotate(30deg);
            }
        }

        /* TELA DE INTRO (TEXTO ROLANDO) */
        #intro-screen {
            justify-content: flex-start;
            perspective: 400px;
            background-color: #000;
        }

        .intro-text {
            transform-origin: center bottom;
            transform: rotateX(25deg) translateY(100vh);
            font-size: 1.8rem;
            line-height: 1.5;
            text-align: center;
            max-width: 80%;
            animation: scrollUp 60s linear forwards;
            animation-play-state: running;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #ffff99;
            text-shadow: 0 0 10px #ffff00;
        }

        @keyframes scrollUp {
            from {
                transform: rotateX(25deg) translateY(100vh);
            }
            to {
                transform: rotateX(25deg) translateY(-300vh);
            }
        }

        .skip-intro {
            position: absolute;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 5px;
            cursor: pointer;
            z-index: 100;
        }

        .skip-intro:hover {
            background-color: rgba(0, 50, 0, 0.9);
        }

        .intro-controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .intro-control {
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 5px;
            cursor: pointer;
        }

        .intro-control:hover {
            background-color: rgba(0, 50, 0, 0.9);
        }

        /* TELA DE HISTÓRIA */
        #story-screen {
            justify-content: flex-start;
            overflow-y: auto;
            background-color: #000;
        }

        .story-container {
            width: 100%;
            max-width: 800px;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding: 20px;
            position: relative;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
        }

        .story-text {
            font-size: 1.2rem;
            line-height: 1.5;
            margin-bottom: 2rem;
            text-align: justify;
            animation: fadeIn 2s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .story-id {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 1rem;
            color: #888;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: auto;
        }

        .option-button {
            padding: 15px;
            background-color: rgba(0, 50, 0, 0.7);
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 5px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .option-button:hover, .option-button:active {
            background-color: rgba(0, 80, 0, 0.9);
            box-shadow: 0 0 10px #00ff00;
        }

        .game-menu {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
        }

        .menu-button {
            padding: 8px 15px;
            background-color: rgba(0, 30, 0, 0.8);
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .menu-button:hover {
            background-color: rgba(0, 60, 0, 0.9);
        }

        .menu-dropdown {
            position: absolute;
            top: 40px;
            left: 0;
            background-color: rgba(0, 20, 0, 0.9);
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 10px;
            display: none;
        }

        .menu-dropdown.active {
            display: block;
        }

        .menu-item {
            padding: 8px 15px;
            color: #00ff00;
            cursor: pointer;
            white-space: nowrap;
        }

        .menu-item:hover {
            background-color: rgba(0, 80, 0, 0.7);
        }

        /* TELA DE COMBATE */
        #combat-screen {
            background-color: rgba(50, 0, 0, 0.8);
        }

        .combat-container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
        }

        .combat-header {
            text-align: center;
            font-size: 1.5rem;
            color: #ff3333;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #ff0000;
        }

        .combat-area {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }

        .combat-character, .combat-enemy {
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid #666;
            border-radius: 10px;
            padding: 15px;
            width: 48%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .health-bar {
            width: 100%;
            height: 20px;
            background-color: #333;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .health-fill {
            height: 100%;
            background-color: #ff3333;
            width: 100%;
            transition: width 0.5s;
        }

        .combat-log {
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid #666;
            border-radius: 10px;
            padding: 10px;
            height: 150px;
            overflow-y: auto;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .combat-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .combat-button {
            padding: 10px 20px;
            background-color: rgba(100, 0, 0, 0.7);
            color: white;
            border: 1px solid #ff3333;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        .combat-button:hover, .combat-button:active {
            background-color: rgba(150, 0, 0, 0.9);
            box-shadow: 0 0 10px #ff3333;
        }

        /* TELA DE QUEBRA-CABEÇA */
        #puzzle-screen {
            background-color: rgba(0, 0, 50, 0.8);
        }

        .puzzle-container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
        }

        .puzzle-header {
            text-align: center;
            font-size: 1.5rem;
            color: #33ccff;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #33ccff;
        }

        .puzzle-description {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #eee;
        }

        .puzzle-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .puzzle-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .puzzle-button {
            padding: 15px 30px;
            background-color: rgba(0, 0, 100, 0.7);
            color: white;
            border: 1px solid #33ccff;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .puzzle-button:hover, .puzzle-button:active {
            background-color: rgba(0, 0, 150, 0.9);
            box-shadow: 0 0 10px #33ccff;
        }

        #history-screen {
            justify-content: flex-start;
            overflow-y: auto;
        }

        .history-container {
            width: 100%;
            max-width: 800px;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
            padding: 20px;
            position: relative;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
        }

        .history-title {
            font-size: 1.8rem;
            text-align: center;
            margin-bottom: 20px;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }

        .history-entry {
            padding: 10px;
            background-color: rgba(0, 30, 0, 0.5);
            border-radius: 5px;
            border-left: 3px solid #00ff00;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .history-entry:hover {
            background-color: rgba(0, 60, 0, 0.7);
        }

        .back-button {
            padding: 10px 20px;
            background-color: rgba(0, 30, 0, 0.7);
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 5px;
            cursor: pointer;
            align-self: center;
            margin-top: 20px;
        }

        .back-button:hover {
            background-color: rgba(0, 60, 0, 0.9);
        }

        /* CONTROLES DE ÁUDIO */
        .audio-controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .audio-button {
            width: 40px;
            height: 40px;
            background-color: rgba(0, 0, 0, 0.6);
            border: 1px solid #00ff00;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            color: #00ff00;
            transition: all 0.3s;
        }
        
        .audio-button:hover {
            background-color: rgba(0, 50, 0, 0.8);
            box-shadow: 0 0 10px #00ff00;
        }
        
        .audio-button svg {
            width: 20px;
            height: 20px;
            fill: #00ff00;
        }
        
        .audio-button.muted svg path {
            d: path("M19,11h-8v6h8v-6z M13,3v2h4v12h-4v2h6v-16h-6z");
        }
        
        .volume-slider {
            width: 80px;
            height: 5px;
            -webkit-appearance: none;
            appearance: none;
            background: rgba(0, 50, 0, 0.5);
            border-radius: 5px;
            outline: none;
        }
        
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #00ff00;
            cursor: pointer;
        }
        
        .volume-slider::-moz-range-thumb {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #00ff00;
            cursor: pointer;
        }
        
        .audio-status {
            color: #00ff00;
            font-size: 0.8rem;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 5px 10px;
            border-radius: 10px;
            display: none;
        }

        /* RESPONSIVIDADE */
        @media (max-width: 768px) {
            .title {
                font-size: 1.8rem;
            }
            
            .intro-text {
                font-size: 1.2rem;
            }
            
            .story-text {
                font-size: 1rem;
            }
            
            .combat-area {
                flex-direction: column;
            }
            
            .combat-character, .combat-enemy {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .title {
                font-size: 1.5rem;
            }
            
            .start-button {
                padding: 10px 30px;
                font-size: 1.2rem;
            }
            
            .intro-text {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- TELA INICIAL -->
    <div id="start-screen" class="screen">
        <div class="stars"></div>
        <div class="space-ship">
            <svg viewBox="0 0 100 50" xmlns="http://www.w3.org/2000/svg">
                <path d="M10,25 L40,10 L90,25 L40,40 Z" fill="#555" stroke="#888" stroke-width="2"/>
                <path d="M90,25 L95,20 L97,25 L95,30 Z" fill="#00ffff" stroke="#00ffff" stroke-width="1"/>
            </svg>
        </div>
        <h1 class="title">DESPERTAR ESTELAR:<br>FUGA OU SALVAÇÃO</h1>
        <div class="start-buttons">
            <button class="start-button" id="start-button">Iniciar</button>
            <button class="start-button" id="continue-button" disabled>Continuar</button>
            <button class="start-button" id="skip-to-story">Pular Prólogo</button>
        </div>
    </div>

    <!-- TELA DE INTRODUÇÃO (TEXTO ROLANDO) -->
    <div id="intro-screen" class="screen hidden">
        <div class="intro-text" id="intro-text">
            <p>Em um futuro distante, onde a humanidade conquistou as estrelas...</p>
            <br>
            <p>A nave colonial Esperança viaja pelos confins do espaço, transportando 200 colonos em criossono para o sistema Kepler-62.</p>
            <br>
            <p>Sua missão: estabelecer a primeira colônia humana permanente fora do Sistema Solar.</p>
            <br>
            <p>O que deveria ser apenas mais um salto hiperespacial rotineiro se transforma em uma luta desesperada pela sobrevivência.</p>
            <br>
            <p>Quando algo dá terrivelmente errado...</p>
            <br>
            <p>Capitão Alex Reiner acorda em uma nave danificada, com sistemas falhando e um mistério mortal por resolver.</p>
            <br>
            <p>Salvar os colonos ou salvar a si mesmo?</p>
            <br>
            <p>A escolha está em suas mãos...</p>
        </div>
        <button class="skip-intro" id="skip-intro-button">Pular Introdução</button>
        <div class="intro-controls">
            <button class="intro-control" id="pause-intro">Pausar</button>
            <button class="intro-control" id="resume-intro" style="display: none;">Continuar</button>
        </div>
    </div>

    <!-- TELA DE HISTÓRIA -->
    <div id="story-screen" class="screen hidden">
        <div class="game-menu">
            <button class="menu-button" id="menu-button">Menu</button>
            <div class="menu-dropdown" id="menu-dropdown">
                <div class="menu-item" id="save-game">Salvar Jogo</div>
                <div class="menu-item" id="load-game">Carregar Jogo</div>
                <div class="menu-item" id="view-history">Ver Histórico</div>
                <div class="menu-item" id="main-menu">Menu Principal</div>
            </div>
        </div>
        <div class="story-container" id="story-container">
            <span class="story-id" id="section-id"></span>
            <div class="story-text" id="story-text"></div>
            <div class="options-container" id="options-container"></div>
        </div>
    </div>

    <!-- TELA DE HISTÓRICO -->
    <div id="history-screen" class="screen hidden">
        <div class="history-container" id="history-container">
            <h2 class="history-title">Histórico da Jornada</h2>
            <div id="history-entries"></div>
            <button class="back-button" id="back-from-history">Voltar à História</button>
        </div>
    </div>

    <!-- TELA DE COMBATE -->
    <div id="combat-screen" class="screen hidden">
        <div class="combat-container">
            <h2 class="combat-header" id="combat-header">COMBATE</h2>
            <div class="combat-area">
                <div class="combat-character">
                    <h3 id="character-name">Capitão Reiner</h3>
                    <div class="health-bar">
                        <div class="health-fill" id="character-health"></div>
                    </div>
                    <div id="character-items">Arma: Pistola de Energia</div>
                </div>
                <div class="combat-enemy">
                    <h3 id="enemy-name">Inimigo</h3>
                    <div class="health-bar">
                        <div class="health-fill" id="enemy-health"></div>
                    </div>
                    <div id="enemy-info"></div>
                </div>
            </div>
            <div class="combat-log" id="combat-log">
                Prepare-se para o combate!
            </div>
            <div class="combat-actions" id="combat-actions">
                <!-- Botões serão adicionados via JavaScript -->
            </div>
        </div>
    </div>

    <!-- TELA DE QUEBRA-CABEÇA -->
    <div id="puzzle-screen" class="screen hidden">
        <div class="puzzle-container">
            <h2 class="puzzle-header" id="puzzle-header">QUEBRA-CABEÇA</h2>
            <p class="puzzle-description" id="puzzle-description"></p>
            <div class="puzzle-content" id="puzzle-content">
                <!-- Conteúdo do quebra-cabeça será adicionado via JavaScript -->
            </div>
            <div class="puzzle-options" id="puzzle-options">
                <!-- Opções serão adicionadas via JavaScript -->
            </div>
        </div>
    </div>

    <!-- CONTROLES DE ÁUDIO -->
    <div class="audio-controls">
        <div class="audio-button" id="audio-toggle">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
            </svg>
        </div>
        <input type="range" min="0" max="100" value="70" class="volume-slider" id="volume-control">
        <div class="audio-status" id="audio-status">Tocando: Tema Inicial</div>
    </div>
    
    <!-- SISTEMA DE ÁUDIO -->
    <audio id="intro-music" loop>
        <source src="https://dl.dropboxusercontent.com/s/rtbigb8l6qhfxmj/space_intro.mp3" type="audio/mpeg">
    </audio>
    
    <audio id="game-music" loop>
        <source src="https://dl.dropboxusercontent.com/s/9a1uxpayvplfxfa/space_main.mp3" type="audio/mpeg">
    </audio>

    <script>
        // -------------------- CONFIGURAÇÕES DO JOGO --------------------
        const SCROLL_SPEED = 60; // Velocidade do texto rolando em segundos
        const TEXT_DELAY = 2; // Tempo de espera em segundos antes e depois do texto
        const GAME_VERSION = "1.0.2";
        const SAVE_KEY = "despertarEstelar_saveData";
        const DEBUG_MODE = true; // Ativar para ver mensagens de debugging no console
        
        // -------------------- DADOS DO JOGO --------------------
        // Definição das seções da história
        const storyData = {
            "intro": {
                text: "Seus olhos se abrem com dificuldade, a visão turva tentando se adaptar à fraca iluminação vermelha de emergência. Sua cabeça lateja como se tivesse sido atingida por um meteoro. As memórias retornam aos poucos: você é o Capitão Alex Reiner da nave colonial Esperança, transportando 200 colonos em criossono para o sistema Kepler-62. O último salto hiperespacial deveria ter sido rotineiro, mas algo deu muito errado.\n\nO painel de controle à sua frente pisca com dezenas de alertas. Uma voz robótica anuncia friamente: \"Falha crítica no núcleo. Colapso estrutural em 120 minutos. Evacuação recomendada.\"\n\nVocê se levanta cambaleante da cadeira do piloto e percebe que está sozinho na ponte. A tripulação deveria estar aqui. Suas opções são limitadas e o tempo, precioso.\n\nO que você faz?",
                options: [
                    { text: "Verificar o sistema de diagnóstico para entender o que aconteceu.", nextSection: "10" },
                    { text: "Ir imediatamente ao setor de criogenia para verificar os passageiros.", nextSection: "20" },
                    { text: "Dirigir-se à sala de comunicações para enviar um pedido de socorro.", nextSection: "30" }
                ]
            },
            "10": {
                text: "O sistema de diagnóstico está parcialmente operacional. Seus dedos deslizam pelo painel holográfico enquanto você navega pelos relatórios técnicos. A situação é pior do que imaginava: durante o salto, uma anomalia quântica causou uma sobrecarga no núcleo de fusão. O sistema de contenção está falhando e o colapso é inevitável.\n\nAs câmeras de segurança mostram vários setores já comprometidos. O setor oeste está completamente lacrado devido à descompressão. No relatório da tripulação, descobre que dos 15 tripulantes, apenas 8 estão vivos, espalhados pela nave e alguns feridos. Os 200 colonos em criossono estão em risco crítico - o sistema de suporte vital está operando com energia de emergência.\n\nUm detalhe chama sua atenção: há apenas 2 cápsulas de escape operacionais, cada uma com capacidade para 50 pessoas.\n\nO que você faz?",
                options: [
                    { text: "Acessar o mapa da nave para planejar uma rota de resgate.", nextSection: "11" },
                    { text: "Verificar o sistema de comunicação interna para contatar sobreviventes.", nextSection: "12" },
                    { text: "Examinar o registro do salto para entender melhor a anomalia.", nextSection: "13" }
                ]
            },
            "11": {
                text: "O mapa holográfico da nave surge diante de você. A Esperança tem 5 níveis principais, com você atualmente na ponte (nível 1). O setor de criogenia está no nível 3, as cápsulas de escape no nível 5, e a sala do reator no nível 4.\n\nRotas diretas entre níveis estão bloqueadas em vários pontos. Será necessário um desvio pelo sistema de manutenção para alcançar qualquer setor crucial.\n\nEnquanto analisa as opções, uma nova mensagem aparece no sistema: \"Detectada atividade não autorizada no setor de segurança. Protocolo de quarentena ativado.\"\n\nIsso não estava no diagnóstico inicial. Alguém ou algo está mexendo nos sistemas de segurança.\n\nO que você faz?",
                options: [
                    { text: "Investigar a atividade suspeita no setor de segurança.", nextSection: "14" },
                    { text: "Ignorar o alerta e seguir para o setor de criogenia.", nextSection: "20" },
                    { text: "Ativar os protocolos de emergência que darão mais tempo antes do colapso.", nextSection: "15" }
                ]
            },
            "12": {
                text: "Você ativa o sistema de comunicação interna. \"Aqui é o Capitão Reiner. Alguém na escuta?\"\n\nApós alguns segundos de estática, uma voz feminina responde: \"Capitão? Graças a Deus! É Elena Vasquez, engenheira-chefe. Estou presa na sala de máquinas auxiliar com o Dr. Petrov. Ele está ferido.\"\n\nOutra voz corta a transmissão: \"Capitão, aqui é Tenente Rodriguez. Estou com três outros tripulantes no laboratório. Tentamos acessar o setor de criogenia, mas o sistema está em lockdown.\"\n\nUma terceira voz, distorcida e entrecortada: \"...sabotagem...não confie...eles querem...\" A transmissão é cortada abruptamente.\n\nO que você faz?",
                options: [
                    { text: "Pedir mais informações à Engenheira Vasquez.", nextSection: "16" },
                    { text: "Solicitar um relatório detalhado ao Tenente Rodriguez.", nextSection: "17" },
                    { text: "Tentar restaurar a última transmissão cortada.", nextSection: "18" }
                ]
            },
            "13": {
                text: "Os registros do salto são confusos. Algo interferiu com os cálculos quânticos no momento exato da transição. A assinatura energética não parece natural -- os padrões sugerem uma interferência deliberada.\n\nUma entrada do diário de bordo, datada de apenas 12 horas antes do salto, chama sua atenção. É do Oficial de Ciências, Dr. Yamamoto: \"Descobri algo preocupante nos dados de longa distância. Preciso falar com o Capitão imediatamente. Se minhas suspeitas estiverem corretas, não estamos sozinhos nesta missão.\"\n\nAo verificar os registros de acesso, você descobre que alguém entrou na sala de controle do salto três minutos antes da inicialização, usando as credenciais do Oficial de Segurança Chen.\n\nO que você faz?",
                options: [
                    { text: "Verificar as câmeras de segurança para ver quem entrou na sala de controle.", nextSection: "19" },
                    { text: "Procurar o Oficial de Segurança Chen pela nave.", nextSection: "21" },
                    { text: "Investigar o último local conhecido do Dr. Yamamoto.", nextSection: "22" }
                ]
            },
            "14": {
                text: "Você navega pelos corredores parcialmente iluminados em direção ao setor de segurança. A gravidade artificial oscila, fazendo com que às vezes seus passos sejam mais leves ou mais pesados.\n\nAo chegar ao setor de segurança, encontra a porta entreaberta. Dentro, vê um homem debruçado sobre o console principal. Ele não está usando uniforme da tripulação.\n\nAo perceber sua presença, ele se vira rapidamente. É um rosto que você não reconhece. \"Capitão,\" ele diz com um sorriso tenso. \"Que bom que está vivo. Estou tentando restaurar os protocolos de segurança.\"\n\nSeu instinto diz que algo está errado. Ele está usando um distintivo de autorização de nível superior que nem mesmo você possui.\n\nO que você faz?",
                options: [
                    { text: "Confrontá-lo diretamente sobre sua identidade.", nextSection: "23" },
                    { text: "Fingir que acredita nele e pedir mais informações.", nextSection: "24" },
                    { text: "Atacá-lo imediatamente, considerando-o uma ameaça.", nextSection: "25" }
                ]
            },
            "15": {
                text: "Você acessa os protocolos de emergência, redirecionando energia dos sistemas não essenciais para reforçar a contenção do núcleo. O sistema informa que isso pode dar à nave mais 30 minutos antes do colapso total.\n\nDurante o processo, você descobre uma sequência de comandos recentemente introduzida no sistema. Alguém programou o desligamento dos suportes de vida no setor de criogenia para daqui a 15 minutos.",
                options: [],
                type: "puzzle",
                puzzleData: {
                    title: "QUEBRA-CABEÇA: CÓDIGO DE SEGURANÇA",
                    description: "Para cancelar esta sequência, você precisa resolver o código de segurança. O sistema fornece a seguinte dica:\n\n\"Eu sou o que resta quando tudo falha. Meu primeiro dígito é o número de planetas habitáveis no sistema Kepler-62. Meu segundo dígito é o número de cápsulas de escape funcionais. Meu terceiro dígito é o número de níveis da nave Esperança. Meu último dígito é o valor de X na equação: 3X + 7 = 22.\"",
                    options: [
                        { text: "2255", nextSection: "26", correct: true },
                        { text: "2250", nextSection: "27", correct: false },
                        { text: "2505", nextSection: "28", correct: false }
                    ]
                }
            },
            "16": {
                text: "\"Capitão,\" a voz de Elena soa ansiosa, \"algo muito estranho aconteceu antes do salto. O Dr. Petrov detectou uma transmissão não autorizada saindo da nave, mas quando fomos investigar, houve uma explosão no corredor J. Petrov acha que foi deliberado.\"\n\n\"Conseguimos acessar brevemente os registros de segurança. Havia passageiros não listados embarcados em Marte. Três deles. Não estão nos registros oficiais.\"\n\nPetrov tosse ao fundo antes de falar: \"Capitão, suspeitamos que sejam agentes de Nova Terra. A colônia em Kepler-62 representa uma vantagem estratégica que eles não queriam que a Aliança obtivesse.\"\n\n\"Precisamos chegar até você,\" diz Elena, \"mas os corredores entre nós estão bloqueados. Há uma forma de nos ajudar a passar pelo sistema de manutenção?\"\n\nO que você faz?",
                options: [
                    { text: "Ajudar Elena e Petrov a navegar pelos dutos de manutenção.", nextSection: "29" },
                    { text: "Pedir que permaneçam onde estão enquanto você verifica a informação sobre os passageiros não listados.", nextSection: "31" },
                    { text: "Instruí-los a tentar alcançar as cápsulas de escape e encontrar você lá.", nextSection: "32" }
                ]
            },
            "17": {
                text: "\"Capitão,\" o Tenente Rodriguez responde com voz firme, \"a situação é crítica. Estou com os oficiais Kowalski, Takahashi e Lin. Tentamos acessar o setor de criogenia, mas alguém alterou os códigos de segurança.\"\n\n\"Descobrimos algo perturbador nos laboratórios. Os dados da missão foram alterados. As coordenadas do salto foram manipuladas para nos levar a este setor específico do espaço. Não foi um acidente.\"\n\n\"Takahashi identificou três assinaturas biométricas não registradas movendo-se pela nave pouco antes do salto. Suspeitamos que são sabotadores.\"\n\nEnquanto ele fala, você ouve um ruído metálico ao fundo, seguido por gritos. A comunicação fica cheia de estática. A última coisa que ouve é: \"Eles estão aqui! Corra para o--\" antes de ser cortada.\n\nO que você faz?",
                options: [
                    { text: "Tentar restabelecer contato com o grupo de Rodriguez.", nextSection: "33" },
                    { text: "Dirigir-se ao laboratório para verificar o que aconteceu.", nextSection: "34" },
                    { text: "Alertar Elena e Petrov sobre o possível perigo.", nextSection: "35" }
                ]
            },
            "18": {
                text: "Você utiliza ferramentas avançadas de análise de áudio para reconstruir a transmissão cortada. Depois de alguns ajustes, consegue recuperar parte da mensagem:\n\n\"...sabotagem confirmada. Não confie na Vasquez. Eles querem os dados do projeto Prometeu. Os passageiros são apenas disfarce. O verdadeiro objetivo é o módulo secreto. Capitão, você precisa acessar o compartimento 772B antes que eles destruam...\"\n\nA mensagem termina aí. Não há identificação de quem a enviou.\n\nVocê verifica rapidamente sua base de dados pessoal. O projeto Prometeu está classificado como ultra-secreto, algo que apenas capitães de alto escalão deveriam conhecer. Envolve tecnologia de terraformação revolucionária.\n\nO compartimento 772B não aparece em nenhum mapa oficial da nave.\n\nO que você faz?",
                options: [
                    { text: "Confrontar Elena Vasquez sobre a mensagem.", nextSection: "36" },
                    { text: "Procurar o misterioso compartimento 772B.", nextSection: "37" },
                    { text: "Ignorar a mensagem, considerando-a uma possível armadilha.", nextSection: "38" }
                ]
            },
            "19": {
                text: "As gravações de segurança mostram uma figura encapuzada entrando na sala de controle do salto. A pessoa move-se com precisão, conhecendo exatamente para onde ir. Ela insere um dispositivo no console principal, digita uma sequência de comandos e sai rapidamente.\n\nO ângulo da câmera não permite ver o rosto, mas você nota um detalhe perturbador: a pessoa usa um bracelete médico idêntico ao da Dra. Yasmin Khoury, a médica-chefe da nave.\n\nConsultando o sistema de localização da tripulação, você descobre que o último registro da Dra. Khoury a coloca no laboratório médico, aproximadamente 20 minutos antes do salto. Não há registros após isso.\n\nO que você faz?",
                options: [
                    { text: "Ir ao laboratório médico investigar o paradeiro da Dra. Khoury.", nextSection: "39" },
                    { text: "Alertar os sobreviventes sobre uma possível impostora.", nextSection: "40" },
                    { text: "Verificar as credenciais e histórico da Dra. Khoury no banco de dados da nave.", nextSection: "41" }
                ]
            },
            "20": {
                text: "O caminho para o setor de criogenia é mais difícil do que esperava. Portas de emergência bloqueiam as rotas principais, forçando-o a navegar por corredores de manutenção estreitos e mal iluminados.\n\nAo chegar à entrada do setor de criogenia, você encontra a porta principal selada. O painel de acesso está danificado, mas ainda funcional. Para abri-lo, precisará resolver um quebra-cabeça de roteamento de energia.",
                options: [],
                type: "puzzle",
                puzzleData: {
                    title: "QUEBRA-CABEÇA: ROTEAMENTO DE ENERGIA",
                    description: "O painel mostra um diagrama com 5 nós de energia (A, B, C, D, E) e 6 caminhos possíveis. Você precisa fazer a energia fluir da fonte ao destino sem sobrecarregar nenhum nó. Cada nó pode suportar apenas duas conexões ativas.",
                    options: [
                        { text: "Conectar A-B-E-D", nextSection: "42", correct: false },
                        { text: "Conectar A-C-B-D", nextSection: "43", correct: true },
                        { text: "Conectar A-C-E-D", nextSection: "44", correct: false }
                    ]
                }
            },
            "21": {
                text: "Você consulta o sistema de localização para encontrar o Oficial Chen. Seu último registro o coloca no Armamento, duas horas antes do salto. Nenhuma atividade desde então.\n\nO caminho para o Armamento está parcialmente bloqueado por destroços. Você navega com dificuldade, passando por corredores que mostram sinais claros de luta - marcas de tiros nas paredes, manchas de sangue no chão.\n\nAo chegar ao Armamento, encontra a porta arrombada. Dentro, o corpo do Oficial Chen está caído próximo ao arsenal. A maioria das armas desapareceu. Ele tem um mensageiro pessoal na mão, travado com segurança biométrica.\n\nO que você faz?",
                options: [
                    { text: "Tentar desbloquear o mensageiro usando o reconhecimento biométrico de Chen.", nextSection: "45" },
                    { text: "Procurar outras pistas no Armamento.", nextSection: "46" },
                    { text: "Pegar qualquer arma restante e continuar sua missão.", nextSection: "47" }
                ]
            },
            "22": {
                text: "O laboratório do Dr. Yamamoto está localizado no nível 2, próximo aos observatórios. Você segue por corredores cada vez mais escuros, com a energia falhando em seções inteiras.\n\nA porta do laboratório está entreaberta. Dentro, encontra um caos de equipamentos quebrados e papéis espalhados. Houve claramente uma busca violenta.\n\nNo centro da sala, um holograma está pausado, mostrando uma estranha estrutura orbital próxima ao ponto de saída do salto hiperespacial. Parece artificial, definitivamente não natural.\n\nNo terminal principal, protegido por uma sequência de segurança, há um arquivo marcado como \"URGENTE - CAPITÃO\".",
                options: [],
                type: "puzzle",
                puzzleData: {
                    title: "QUEBRA-CABEÇA: SEQUÊNCIA NUMÉRICA",
                    description: "Para acessar o arquivo, você precisa resolver a sequência:\n8, 27, ?, 125, 216\n\nQual número falta?",
                    options: [
                        { text: "64", nextSection: "48", correct: true },
                        { text: "36", nextSection: "49", correct: false },
                        { text: "81", nextSection: "50", correct: false }
                    ]
                }
            },
            "23": {
                text: "\"Quem é você realmente?\" você pergunta, mantendo distância. \"Esse distintivo não está autorizado nem mesmo para mim.\"\n\nO homem congela por um momento, então seu comportamento muda completamente. Ele se endireita e sorri com confiança.\n\n\"Perspicaz, Capitão. Teria sido mais fácil se você simplesmente corresse para as cápsulas como previsto.\" Ele não parece preocupado com sua presença. \"Meu nome não importa. Represento pessoas que têm grande interesse no que esta nave transporta.\"\n\n\"O salto foi apenas parcialmente sabotado. Não queríamos destruir a nave, apenas desviá-la para este setor para que meus associados pudessem recuperar o módulo Prometeu. Os colonos são apenas... cobertura conveniente.\"\n\nEle saca uma arma. \"Agora, temos aproximadamente 90 minutos antes que esta nave se desintegre. Você pode cooperar e me levar ao compartimento 772B, ou posso encontrá-lo sozinho depois de eliminar você.\"\n\nO que você faz?",
                options: [
                    { text: "Tentar negociar para ganhar tempo.", nextSection: "51" },
                    { text: "Atacar imediatamente, aproveitando sua proximidade.", nextSection: "52" },
                    { text: "Fingir cooperação para descobrir mais sobre seus planos.", nextSection: "53" }
                ]
            },
            "24": {
                text: "\"Entendo,\" você diz, tentando parecer aliviado. \"Que bom que alguém está trabalhando nisso. Qual é a situação atual dos sistemas?\"\n\nO homem parece relaxar um pouco, voltando sua atenção ao console. \"Estou tentando restabelecer o controle após o... incidente. Alguns membros da tripulação estão complicando as coisas. Especialmente aqueles no laboratório.\"\n\nEnquanto ele fala, você nota algo estranho - ele está inserindo comandos para desativar os sistemas de suporte vital em várias seções da nave.\n\n\"O Diretor ficará satisfeito por você ter sobrevivido, Capitão,\" ele continua. \"Quase pensamos que tínhamos perdido você junto com os outros na ponte.\"\n\nVocê não estava sozinho na ponte quando acordou? E qual diretor?\n\nO que você faz?",
                options: [
                    { text: "Continuar o disfarce, tentando obter mais informações.", nextSection: "54" },
                    { text: "Procurar uma arma ou objeto para neutralizá-lo.", nextSection: "55" },
                    { text: "Ativar discretamente o alarme de segurança no seu comunicador.", nextSection: "56" }
                ]
            },
            "25": {
                type: "combat",
                text: "Sem hesitar, você avança contra o desconhecido. O elemento surpresa funciona a seu favor - ele não espera um ataque frontal.",
                combatData: {
                    enemyName: "Sabotador Desconhecido",
                    enemyInfo: "Armado com pistola de energia",
                    playerHealth: 100,
                    enemyHealth: 80,
                    playerItems: ["Ferramenta de reparo", "Comunicador de emergência", "Kit médico básico"],
                    outcomes: [
                        { result: "victory", nextSection: "57" },
                        { result: "defeat", nextSection: "58" }
                    ]
                }
            },
            "26": {
                text: "Você insere o código 2255. O painel acende verde: \"Código correto. Sequência cancelada. Sistemas de suporte vital no setor de criogenia estabilizados.\"\n\nVocê suspira aliviado. Os colonos estão temporariamente seguros, mas o tempo continua correndo para o colapso do núcleo.\n\nEnquanto avalia suas próximas opções, uma nova mensagem surge no console: \"Transmissão recebida. Origem: desconhecida.\"\n\nAo abrir a mensagem, você vê coordenadas espaciais e uma mensagem críptica: \"A Prometeu está comprometida. Rendezvous em Delta-9. Elimine testemunhas.\"\n\nA mensagem claramente não era destinada a você.\n\nO que você faz?",
                options: [
                    { text: "Rastrear a origem da transmissão.", nextSection: "60" },
                    { text: "Investigar o que é \"Prometeu\" nos bancos de dados da nave.", nextSection: "61" },
                    { text: "Ignorar a mensagem e seguir para o setor de criogenia.", nextSection: "62" }
                ]
            },
            "27": {
                text: "Você insere o código 2250. O sistema pisca vermelho: \"Código incorreto. Uma tentativa restante.\"\n\nReanalisando o quebra-cabeça com atenção: o sistema Kepler-62 tem 2 planetas habitáveis confirmados, existem 2 cápsulas de escape funcionais, a nave tem 5 níveis, e resolvendo 3X + 7 = 22, temos X = 5.\n\nSua última chance:",
                options: [
                    { text: "Inserir o código 2255.", nextSection: "26" },
                    { text: "Inserir o código 2505.", nextSection: "28" }
                ]
            },
            "28": {
                text: "Você insere o código 2505. O sistema pisca vermelho: \"Código incorreto. Acesso bloqueado. Alerta enviado à segurança.\"\n\nVocê tenta contornar o bloqueio, mas sem sucesso. Agora está preso, e o tempo está acabando. Você precisará encontrar outra forma de salvar os colonos.\n\nEnquanto pondera suas opções, ouve passos se aproximando pelo corredor. Alguém vem verificar o alerta de segurança.\n\nO que você faz?",
                options: [
                    { text: "Esconder-se e observar quem vem investigar.", nextSection: "63" },
                    { text: "Preparar-se para confrontar quem vier.", nextSection: "64" },
                    { text: "Fugir e buscar outro caminho para o setor de criogenia.", nextSection: "65" }
                ]
            },
            "29": {
                text: "Você acessa o sistema de manutenção e estabelece comunicação com Elena e Petrov. Usando o mapa da nave, você os guia através dos dutos de serviço.\n\n\"Há uma passagem de manutenção a dez metros à sua direita,\" você instrui. \"Isso levará vocês ao elevador de carga secundário, que ainda está operacional.\"\n\nEnquanto os guia, Elena compartilha mais informações: \"Antes do salto, interceptamos uma transmissão codificada. Petrov conseguiu decifrar parte dela - mencionava algo chamado 'Projeto Prometeu' e um 'módulo de contenção'. Você sabe do que se trata, Capitão?\"\n\nAntes que você possa responder, ouve sons de luta e gritos. A comunicação fica fragmentada.\n\nElena: \"Eles nos encontraram! São--\" A transmissão é cortada.\n\nO que você faz?",
                options: [
                    { text: "Tentar restabelecer contato com Elena e Petrov.", nextSection: "66" },
                    { text: "Dirigir-se ao local onde estavam para ajudá-los.", nextSection: "67" },
                    { text: "Continuar sua missão, presumindo que foram capturados.", nextSection: "68" }
                ]
            },
            "30": {
                text: "Você se dirige rapidamente à sala de comunicações, atravessando corredores instáveis. No caminho, encontra evidências de conflito - marcas de queimaduras nas paredes, objetos espalhados, como se houvesse uma luta recente.\n\nAo chegar à sala de comunicações, encontra um técnico ferido - Oficial Yusuf - trabalhando no console de transmissão. Ele se vira ao ouvir você entrar, visivelmente aliviado.\n\n\"Capitão! Graças a Deus você está vivo. Tentei estabelecer contato com qualquer nave na proximidade, mas algo está bloqueando nossas transmissões de longo alcance.\"\n\nYusuf aponta para um monitor mostrando dados de comunicação. \"Há uma interferência artificial cobrindo todas as frequências principais. Não é natural - alguém não quer que peçamos ajuda.\"\n\nO que você faz?",
                options: [
                    { text: "Tentar contornar a interferência para enviar um sinal de socorro.", nextSection: "77" },
                    { text: "Perguntar a Yusuf o que ele sabe sobre o incidente.", nextSection: "78" },
                    { text: "Verificar os registros de comunicação anteriores ao salto.", nextSection: "79" }
                ]
            },
            "36": {
                text: "Você reestabelece contato com Elena Vasquez. Desta vez, sua voz é fria e calculada: \"Engenheira Vasquez, acabo de interceptar uma mensagem muito interessante sobre você. Algo sobre não confiar em você e o Projeto Prometeu. Gostaria de explicar?\"\n\nO silêncio que segue é perturbador. Finalmente, Elena responde, sua voz completamente diferente - sem o nervosismo anterior, apenas eficiência clínica:\n\n\"Impressionante, Capitão. Esperava ter mais tempo antes que descobrisse. Sim, tenho interesse no Prometeu, mas não sou sua inimiga. A verdade é mais complexa.\"\n\n\"Nova Terra não é o que pensam. Descobrimos que a Aliança planeja usar o Prometeu como arma, não como ferramenta de terraformação. Estou aqui para impedir isso.\"\n\n\"Petrov não sabe minha verdadeira identidade. Ele é apenas um peão, assim como você seria. Mas agora precisamos colaborar ou todos morreremos.\"\n\nO que você faz?",
                options: [
                    { text: "Fingir acreditar nela para obter mais informações.", nextSection: "94" },
                    { text: "Confrontá-la abertamente, exigindo toda a verdade.", nextSection: "95" },
                    { text: "Encerrar a comunicação e procurar o compartimento 772B sozinho.", nextSection: "96" }
                ]
            },
            "37": {
                text: "Decidido a encontrar o misterioso compartimento 772B, você consulta os esquemas detalhados da nave. Curiosamente, esta seção não aparece em nenhum mapa oficial, mas cruzando informações de consumo de energia e rotas de manutenção, você identifica uma anomalia.\n\nHá um espaço não contabilizado entre o armazém principal e o setor de pesquisa no nível 4. Seguindo seu instinto, você se dirige para lá.\n\nO caminho é perigoso - várias seções sofreram danos estruturais. Ao chegar ao local aproximado, você encontra apenas uma parede lisa sem entradas visíveis. No entanto, seu scanner detecta um campo energético anômalo.\n\nExaminando mais detalhadamente, você percebe um pequeno painel oculto. Ao ativá-lo, uma interface de segurança solicita credenciais de nível máximo e uma sequência biométrica.",
                options: [
                    { text: "Tentar usar suas credenciais de capitão.", nextSection: "97" },
                    { text: "Tentar contornar o sistema de segurança hackeando-o.", nextSection: "98" },
                    { text: "Procurar alguém com autorização adequada, como o Dr. Yamamoto.", nextSection: "99" }
                ]
            },
            "38": {
                text: "Você decide ignorar a mensagem enigmática. Poderia ser uma armadilha para desviá-lo de sua missão principal: salvar os colonos e a tripulação restante.\n\nO núcleo continua em deterioração e o tempo é essencial. Consultando o mapa da nave, você traça a rota mais eficiente para o setor de criogenia, onde os 200 colonos permanecem vulneráveis em sono profundo.\n\nNo caminho, seu comunicador capta uma transmissão fragmentada - são coordenadas espaciais seguidas por uma contagem regressiva. Algo vai acontecer em menos de 60 minutos, além do colapso previsto da nave.\n\nReferências ao \"Prometeu\" continuam surgindo. Seja lá o que for, parece central neste mistério.\n\nO que você faz?",
                options: [
                    { text: "Manter o curso para o setor de criogenia, ignorando as distrações.", nextSection: "20" },
                    { text: "Investigar as coordenadas espaciais recebidas.", nextSection: "100" },
                    { text: "Reconsiderar e procurar informações sobre o Projeto Prometeu nos bancos de dados da nave.", nextSection: "101" }
                ]
            },
            // Mais seções aqui...
            "final": {
                text: "À medida que você pilota a nave de fuga através dos destroços da Esperança, olha pela janela uma última vez. A enorme estrutura que foi seu lar por tanto tempo agora se desintegra em uma explosão silenciosa no vácuo do espaço.\n\nNa cabine atrás de você, os sobreviventes que conseguiu resgatar - uma mistura de tripulantes e colonos despertados - observam em silêncio. Alguns choram, outros simplesmente encaram o vazio, processando o trauma e a perda.\n\nO módulo Prometeu está seguro, seja para ser destruído ou entregue às autoridades adequadas, dependendo das escolhas que você fez. A verdade sobre a sabotagem e os impostores veio à tona, embora a um custo terrível.\n\nNo painel de navegação, as coordenadas da estação mais próxima piscam - está a três semanas de distância no espaço normal. Uma viagem longa com recursos limitados, mas há esperança.\n\nEnquanto a nave acelera para longe dos destroços, você reflete sobre as decisões que tomou, as vidas que conseguiu salvar e aquelas que teve que deixar para trás. Algumas escolhas o assombrarão para sempre, outras trarão um senso de dever cumprido.\n\nUma coisa é certa: nada será como antes. E enquanto as estrelas se estendem infinitas à sua frente, você se pergunta o que o futuro reserva para os sobreviventes da Esperança.\n\nFIM DA AVENTURA",
                options: [
                    { text: "Jogar novamente", nextSection: "intro" }
                ]
            }
        };

        // -------------------- ITENS DO JOGO (ALEATÓRIOS) --------------------
        const randomWeapons = ["Pistola de Plasma", "Rifle de Pulso", "Lança-Dardos Tranquilizantes", "Bastão de Choque"];
        const randomItems = ["Kit Médico Avançado", "Injetor de Adrenalina", "Escudo Pessoal", "Módulo de Camuflagem"];
        const randomEnemies = ["Agente de Nova Terra", "Sabotador Infiltrado", "Segurança Corrompido", "Mercenário Contratado"];

        // -------------------- VARIÁVEIS GLOBAIS --------------------
        let currentSection = "intro";
        let introAnimationPaused = false;
        let textScrollTimeout;
        let gameHistory = [];
        let menuOpen = false;
        let audioEnabled = true;
        let currentTrack = "intro";
        let volumeLevel = 0.7;

        // -------------------- ELEMENTOS DE ÁUDIO --------------------
        const introMusic = document.getElementById('intro-music');
        const gameMusic = document.getElementById('game-music');
        const audioToggle = document.getElementById('audio-toggle');
        const volumeControl = document.getElementById('volume-control');
        const audioStatus = document.getElementById('audio-status');

        // -------------------- FUNÇÕES PRINCIPAIS --------------------
        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }

        function showScreen(screenId) {
            console.log(`Mostrando tela: ${screenId}`);
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function startIntroAnimation() {
            const introText = document.getElementById('intro-text');
            introText.style.animation = `scrollUp ${SCROLL_SPEED}s linear forwards`;
            
            document.getElementById('skip-intro-button').addEventListener('click', function() {
                clearTimeout(textScrollTimeout);
                showScreen('story-screen');
                loadSection('intro');
                changeTrack("game");
            });
            
            document.getElementById('pause-intro').addEventListener('click', pauseIntroText);
            document.getElementById('resume-intro').addEventListener('click', resumeIntroText);
            
            textScrollTimeout = setTimeout(() => {
                showScreen('story-screen');
                loadSection('intro');
                changeTrack("game");
            }, (SCROLL_SPEED * 1000));
        }

        function pauseIntroText() {
            if (!introAnimationPaused) {
                document.getElementById('intro-text').style.animationPlayState = 'paused';
                document.getElementById('pause-intro').style.display = 'none';
                document.getElementById('resume-intro').style.display = 'inline-block';
                introAnimationPaused = true;
                clearTimeout(textScrollTimeout);
            }
        }

        function resumeIntroText() {
            if (introAnimationPaused) {
                document.getElementById('intro-text').style.animationPlayState = 'running';
                document.getElementById('resume-intro').style.display = 'none';
                document.getElementById('pause-intro').style.display = 'inline-block';
                introAnimationPaused = false;
                
                const remainingTime = SCROLL_SPEED * 1000 * 0.7;
                textScrollTimeout = setTimeout(() => {
                    showScreen('story-screen');
                    loadSection('intro');
                    changeTrack("game");
                }, remainingTime);
            }
        }

        function loadSection(sectionId) {
            console.log(`Carregando seção: ${sectionId}`);
            
            currentSection = sectionId;
            const section = storyData[sectionId];
            
            if (!section) {
                console.error(`Seção ${sectionId} não encontrada!`);
                alert(`Erro: Seção ${sectionId} não encontrada. Retornando ao menu inicial.`);
                showScreen('start-screen');
                return;
            }
            
            if (section.text) {
                addToHistory(sectionId, section.text);
            }
            
            if (section.type === 'combat') {
                setupCombat(section);
                return;
            } else if (section.type === 'puzzle') {
                setupPuzzle(section);
                return;
            }
            
            document.getElementById('section-id').textContent = `Seção ${sectionId}`;
            document.getElementById('story-text').innerHTML = section.text.replace(/\n/g, '<br>');
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            if (section.options && section.options.length > 0) {
                section.options.forEach(option => {
                    const button = document.createElement('button');
                    button.classList.add('option-button');
                    button.textContent = option.text;
                    button.addEventListener('click', () => {
                        console.log(`Clique em opção para seção: ${option.nextSection}`);
                        loadSection(option.nextSection);
                    });
                    optionsContainer.appendChild(button);
                });
            } else {
                console.warn(`A seção ${sectionId} não tem opções definidas.`);
                const button = document.createElement('button');
                button.classList.add('option-button');
                button.textContent = "Continuar...";
                button.addEventListener('click', () => {
                    showScreen('start-screen');
                });
                optionsContainer.appendChild(button);
            }
            
            showScreen('story-screen');
        }

        function generateStars() {
            const starsContainer = document.querySelector('.stars');
            const numberOfStars = 200;
            
            for (let i = 0; i < numberOfStars; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                star.style.width = `${Math.random() * 3}px`;
                star.style.height = star.style.width;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 2}s`;
                starsContainer.appendChild(star);
            }
        }

        function setupStartScreen() {
            generateStars();
            
            document.getElementById('start-button').addEventListener('click', function() {
                showScreen('intro-screen');
                startIntroAnimation();
                initAudio();
            });
            
            document.getElementById('continue-button').addEventListener('click', function() {
                if (!loadGame()) {
                    alert("Não foi possível carregar o jogo salvo.");
                } else {
                    changeTrack("game");
                    initAudio();
                }
            });
            
            document.getElementById('skip-to-story').addEventListener('click', function() {
                showScreen('story-screen');
                loadSection('intro');
                changeTrack("game");
                initAudio();
            });
            
            if (localStorage.getItem(SAVE_KEY)) {
                document.getElementById('continue-button').disabled = false;
            }
        }

        function setupMenu() {
            document.getElementById('menu-button').addEventListener('click', toggleMenu);
            
            document.getElementById('save-game').addEventListener('click', function() {
                saveGame();
                toggleMenu();
            });
            
            document.getElementById('load-game').addEventListener('click', function() {
                loadGame();
                toggleMenu();
            });
            
            document.getElementById('view-history').addEventListener('click', function() {
                showHistory();
                toggleMenu();
            });
            
            document.getElementById('main-menu').addEventListener('click', function() {
                if (confirm("Voltar ao menu principal? O progresso não salvo será perdido.")) {
                    showScreen('start-screen');
                }
                toggleMenu();
            });
            
            document.getElementById('back-from-history').addEventListener('click', function() {
                showScreen('story-screen');
            });
            
            document.addEventListener('click', function(event) {
                if (menuOpen && !event.target.closest('.game-menu')) {
                    toggleMenu();
                }
            });
        }

        function toggleMenu() {
            menuOpen = !menuOpen;
            document.getElementById('menu-dropdown').classList.toggle('active', menuOpen);
        }

        function saveGame() {
            const saveData = {
                currentSection: currentSection,
                gameHistory: gameHistory,
                gameVersion: GAME_VERSION
            };
            
            localStorage.setItem(SAVE_KEY, JSON.stringify(saveData));
            alert("Jogo salvo com sucesso!");
        }

        function loadGame() {
            const saveData = localStorage.getItem(SAVE_KEY);
            
            if (!saveData) {
                alert("Nenhum jogo salvo encontrado!");
                return false;
            }
            
            try {
                const data = JSON.parse(saveData);
                
                if (data.gameVersion !== GAME_VERSION) {
                    if (!confirm("O jogo salvo é de uma versão diferente. Carregar mesmo assim?")) {
                        return false;
                    }
                }
                
                currentSection = data.currentSection;
                gameHistory = data.gameHistory || [];
                
                loadSection(currentSection);
                return true;
            } catch (e) {
                alert("Erro ao carregar o jogo: " + e.message);
                return false;
            }
        }

        function addToHistory(sectionId, text) {
            if (gameHistory.length >= 20) {
                gameHistory.shift();
            }
            
            gameHistory.push({
                sectionId: sectionId,
                text: text.substring(0, 100) + (text.length > 100 ? "..." : "")
            });
        }

        function showHistory() {
            const historyEntries = document.getElementById('history-entries');
            historyEntries.innerHTML = '';
            
            if (gameHistory.length === 0) {
                historyEntries.innerHTML = '<div class="history-entry">Nenhuma entrada no histórico ainda.</div>';
                return;
            }
            
            gameHistory.forEach((entry, index) => {
                const entryElement = document.createElement('div');
                entryElement.classList.add('history-entry');
                entryElement.textContent = `${index + 1}. ${entry.text}`;
                entryElement.addEventListener('click', () => {
                    if (confirm(`Voltar para esta parte da história? (Seção ${entry.sectionId})`)) {
                        loadSection(entry.sectionId);
                    }
                });
                historyEntries.appendChild(entryElement);
            });
            
            showScreen('history-screen');
        }

        // -------------------- FUNÇÕES DE ÁUDIO --------------------
        function initAudio() {
            console.log("Inicializando áudio");
            if (introMusic && gameMusic) {
                introMusic.volume = volumeLevel;
                gameMusic.volume = volumeLevel;
                
                try {
                    if (audioEnabled) {
                        if (currentTrack === "intro") {
                            introMusic.play();
                        } else {
                            gameMusic.play();
                        }
                        
                        if (audioStatus) {
                            audioStatus.textContent = currentTrack === "intro" ? "Tocando: Tema Inicial" : "Tocando: Tema Principal";
                            audioStatus.style.display = "block";
                            setTimeout(() => { audioStatus.style.display = "none"; }, 3000);
                        }
                    }
                } catch (e) {
                    console.error("Erro ao inicializar áudio:", e);
                }
            } else {
                console.warn("Elementos de áudio não encontrados");
            }
        }

        function changeTrack(track) {
            console.log(`Alterando faixa para: ${track}`);
            if (!audioEnabled || !introMusic || !gameMusic) return;
            
            try {
                if (track === "intro" && currentTrack !== "intro") {
                    gameMusic.pause();
                    gameMusic.currentTime = 0;
                    introMusic.play();
                    currentTrack = "intro";
                } else if (track === "game" && currentTrack !== "game") {
                    introMusic.pause();
                    introMusic.currentTime = 0;
                    gameMusic.play();
                    currentTrack = "game";
                }
                
                if (audioStatus) {
                    audioStatus.textContent = currentTrack === "intro" ? "Tocando: Tema Inicial" : "Tocando: Tema Principal";
                    audioStatus.style.display = "block";
                    setTimeout(() => { audioStatus.style.display = "none"; }, 3000);
                }
            } catch (e) {
                console.error("Erro ao trocar faixa:", e);
            }
        }

        function setupAudioControls() {
            if (audioToggle) {
                audioToggle.addEventListener('click', function() {
                    audioEnabled = !audioEnabled;
                    
                    if (audioEnabled) {
                        if (currentTrack === "intro" && introMusic) {
                            introMusic.play();
                        } else if (gameMusic) {
                            gameMusic.play();
                        }
                        
                        audioToggle.classList.remove('muted');
                    } else {
                        if (introMusic) introMusic.pause();
                        if (gameMusic) gameMusic.pause();
                        
                        audioToggle.classList.add('muted');
                    }
                    
                    if (audioStatus) {
                        audioStatus.textContent = audioEnabled ? 
                            (currentTrack === "intro" ? "Tocando: Tema Inicial" : "Tocando: Tema Principal") : 
                            "Áudio Desativado";
                        audioStatus.style.display = "block";
                        setTimeout(() => { audioStatus.style.display = "none"; }, 3000);
                    }
                });
            }
            
            if (volumeControl) {
                volumeControl.addEventListener('input', function() {
                    volumeLevel = this.value / 100;
                    
                    if (introMusic) introMusic.volume = volumeLevel;
                    if (gameMusic) gameMusic.volume = volumeLevel;
                    
                    if (audioStatus) {
                        audioStatus.textContent = `Volume: ${this.value}%`;
                        audioStatus.style.display = "block";
                        setTimeout(() => { audioStatus.style.display = "none"; }, 1500);
                    }
                });
            }
        }

        // -------------------- FUNÇÕES DE COMBATE E QUEBRA-CABEÇA --------------------
        function setupCombat(section) {
            const combat = section.combatData;
            
            document.getElementById('combat-header').textContent = "COMBATE";
            document.getElementById('enemy-name').textContent = combat.enemyName;
            document.getElementById('enemy-info').textContent = combat.enemyInfo;
            
            document.getElementById('character-health').style.width = '100%';
            document.getElementById('enemy-health').style.width = '100%';
            
            const randomPlayerItems = [];
            for (let i = 0; i < 3; i++) {
                randomPlayerItems.push(getRandomItem(randomItems));
            }
            
            document.getElementById('character-items').innerHTML = `Arma: ${getRandomItem(randomWeapons)}<br>Itens: ${randomPlayerItems.join(', ')}`;
            
            const actionsContainer = document.getElementById('combat-actions');
            actionsContainer.innerHTML = '';
            
            const actions = [
                { text: "Atacar", action: "attack" },
                { text: "Defender", action: "defend" },
                { text: `Usar ${randomPlayerItems[0]}`, action: "useItem1" },
                { text: `Usar ${randomPlayerItems[1]}`, action: "useItem2" },
                { text: `Usar ${randomPlayerItems[2]}`, action: "useItem3" }
            ];
            
            actions.forEach(action => {
                const button = document.createElement('button');
                button.classList.add('combat-button');
                button.textContent = action.text;
                button.addEventListener('click', () => performCombatAction(action.action, combat));
                actionsContainer.appendChild(button);
            });
            
            document.getElementById('combat-log').innerHTML = section.text + '<br>Prepare-se para o combate!';
            
            showScreen('combat-screen');
        }

        function performCombatAction(action, combat) {
            const log = document.getElementById('combat-log');
            const characterHealth = document.getElementById('character-health');
            const enemyHealth = document.getElementById('enemy-health');
            
            let playerHealthValue = parseInt(characterHealth.style.width) || 100;
            let enemyHealthValue = parseInt(enemyHealth.style.width) || 100;
            
            let actionResult = '';
            let playerDamage = 0;
            let enemyDamage = 0;
            
            switch(action) {
                case 'attack':
                    playerDamage = Math.floor(Math.random() * 30) + 10;
                    actionResult = `Você ataca o ${combat.enemyName}, causando ${playerDamage} de dano!`;
                    break;
                case 'defend':
                    actionResult = 'Você assume uma postura defensiva, reduzindo o dano recebido.';
                    break;
                case 'useItem1':
                case 'useItem2':
                case 'useItem3':
                    const effectType = Math.floor(Math.random() * 3);
                    if (effectType === 0) {
                        playerDamage = Math.floor(Math.random() * 40) + 20;
                        actionResult = `Você usa o item e causa ${playerDamage} de dano!`;
                    } else if (effectType === 1) {
                        playerHealthValue = Math.min(100, playerHealthValue + Math.floor(Math.random() * 30) + 10);
                        actionResult = 'Você usa o item para recuperar sua saúde!';
                    } else {
                        playerDamage = Math.floor(Math.random() * 20) + 5;
                        enemyDamage = Math.floor(Math.random() * 15) + 5;
                        actionResult = `Você usa o item causando ${playerDamage} de dano, mas sofre ${enemyDamage} de dano como efeito colateral!`;
                    }
                    break;
            }
            
            enemyHealthValue = Math.max(0, enemyHealthValue - playerDamage);
            enemyHealth.style.width = `${enemyHealthValue}%`;
            
            if (enemyHealthValue > 0 && action !== 'defend') {
                const enemyAttackDamage = Math.floor(Math.random() * 25) + 5;
                playerHealthValue = Math.max(0, playerHealthValue - enemyAttackDamage);
                actionResult += `<br>${combat.enemyName} contra-ataca, causando ${enemyAttackDamage} de dano!`;
            } else if (enemyHealthValue > 0 && action === 'defend') {
                const reducedDamage = Math.floor(Math.random() * 15) + 1;
                playerHealthValue = Math.max(0, playerHealthValue - reducedDamage);
                actionResult += `<br>${combat.enemyName} ataca, mas sua defesa reduz o dano para ${reducedDamage}!`;
            }
            
            playerHealthValue = Math.max(0, playerHealthValue - enemyDamage);
            characterHealth.style.width = `${playerHealthValue}%`;
            
            log.innerHTML += '<br>' + actionResult;
            log.scrollTop = log.scrollHeight;
            
            if (enemyHealthValue <= 0 || playerHealthValue <= 0) {
                const result = enemyHealthValue <= 0 ? 'victory' : 'defeat';
                let nextSection = 'final';
                
                if (combat.outcomes) {
                    const outcome = combat.outcomes.find(o => o.result === result);
                    if (outcome) nextSection = outcome.nextSection;
                }
                
                setTimeout(() => {
                    log.innerHTML += '<br><br>' + (result === 'victory' ? 'Você derrotou o inimigo!' : 'Você foi derrotado!');
                    
                    setTimeout(() => {
                        loadSection(nextSection);
                    }, 2000);
                }, 1000);
                
                document.querySelectorAll('.combat-button').forEach(button => {
                    button.disabled = true;
                });
            }
        }

        function setupPuzzle(section) {
            const puzzle = section.puzzleData;
            
            document.getElementById('puzzle-header').textContent = puzzle.title;
            document.getElementById('puzzle-description').innerHTML = puzzle.description.replace(/\n/g, '<br>');
            
            const puzzleContent = document.getElementById('puzzle-content');
            puzzleContent.innerHTML = '';
            
            if (puzzle.title.includes("ROTEAMENTO DE ENERGIA")) {
                const diagramSvg = document.createElement('div');
                diagramSvg.innerHTML = `
                    <svg width="300" height="200" viewBox="0 0 300 200">
                        <circle cx="50" cy="100" r="20" fill="#333" stroke="#00ff00" stroke-width="2"/>
                        <text x="50" y="105" text-anchor="middle" fill="#00ff00" font-size="16">A</text>
                        
                        <circle cx="150" cy="50" r="20" fill="#333" stroke="#00ff00" stroke-width="2"/>
                        <text x="150" y="55" text-anchor="middle" fill="#00ff00" font-size="16">B</text>
                        
                        <circle cx="150" cy="150" r="20" fill="#333" stroke="#00ff00" stroke-width="2"/>
                        <text x="150" y="155" text-anchor="middle" fill="#00ff00" font-size="16">C</text>
                        
                        <circle cx="250" cy="100" r="20" fill="#333" stroke="#00ff00" stroke-width="2"/>
                        <text x="250" y="105" text-anchor="middle" fill="#00ff00" font-size="16">D</text>
                        
                        <circle cx="200" cy="175" r="20" fill="#333" stroke="#00ff00" stroke-width="2"/>
                        <text x="200" y="180" text-anchor="middle" fill="#00ff00" font-size="16">E</text>
                        
                        <line x1="70" y1="100" x2="130" y2="50" stroke="#00ff00" stroke-width="2" stroke-dasharray="5,5"/>
                        <line x1="70" y1="100" x2="130" y2="150" stroke="#00ff00" stroke-width="2" stroke-dasharray="5,5"/>
                        <line x1="170" y1="50" x2="230" y2="100" stroke="#00ff00" stroke-width="2" stroke-dasharray="5,5"/>
                        <line x1="170" y1="150" x2="230" y2="100" stroke="#00ff00" stroke-width="2" stroke-dasharray="5,5"/>
                        <line x1="170" y1="150" x2="180" y2="175" stroke="#00ff00" stroke-width="2" stroke-dasharray="5,5"/>
                        <line x1="220" y1="175" x2="230" y2="100" stroke="#00ff00" stroke-width="2" stroke-dasharray="5,5"/>
                    </svg>
                `;
                puzzleContent.appendChild(diagramSvg);
            } else if (puzzle.title.includes("SEQUÊNCIA")) {
                const sequenceHighlight = document.createElement('div');
                sequenceHighlight.style.fontSize = "1.5rem";
                sequenceHighlight.style.margin = "20px auto";
                sequenceHighlight.style.padding = "10px";
                sequenceHighlight.style.backgroundColor = "rgba(0, 0, 80, 0.5)";
                sequenceHighlight.style.borderRadius = "5px";
                sequenceHighlight.style.textAlign = "center";
                
                if (puzzle.description.includes("8, 27, ?, 125, 216")) {
                    sequenceHighlight.innerHTML = "8, 27, <strong style='color:#33ccff; font-size:2rem;'>?</strong>, 125, 216";
                } else {
                    sequenceHighlight.textContent = "Sequência desafiadora";
                }
                
                puzzleContent.appendChild(sequenceHighlight);
            } else if (puzzle.title.includes("CÓDIGO DE SEGURANÇA")) {
                const codePanel = document.createElement('div');
                codePanel.style.width = "200px";
                codePanel.style.height = "50px";
                codePanel.style.backgroundColor = "rgba(0, 0, 0, 0.7)";
                codePanel.style.border = "1px solid #33ccff";
                codePanel.style.borderRadius = "5px";
                codePanel.style.margin = "20px auto";
                codePanel.style.display = "flex";
                codePanel.style.justifyContent = "center";
                codePanel.style.alignItems = "center";
                codePanel.style.fontSize = "2rem";
                codePanel.style.color = "#33ccff";
                codePanel.style.letterSpacing = "10px";
                codePanel.innerHTML = "____";
                
                puzzleContent.appendChild(codePanel);
            }
            
            const puzzleOptions = document.getElementById('puzzle-options');
            puzzleOptions.innerHTML = '';
            
            puzzle.options.forEach(option => {
                const button = document.createElement('button');
                button.classList.add('puzzle-button');
                button.textContent = option.text;
                button.addEventListener('click', () => {
                    if (option.correct) {
                        button.style.backgroundColor = "rgba(0, 100, 0, 0.9)";
                        button.style.boxShadow = "0 0 15px #00ff00";
                    } else {
                        button.style.backgroundColor = "rgba(100, 0, 0, 0.9)";
                        button.style.boxShadow = "0 0 15px #ff0000";
                    }
                    
                    setTimeout(() => {
                        loadSection(option.nextSection);
                    }, 800);
                });
                puzzleOptions.appendChild(button);
            });
            
            showScreen('puzzle-screen');
        }

        // -------------------- INICIALIZAÇÃO --------------------
        window.onload = function() {
            console.log("Inicializando jogo");
            setupStartScreen();
            setupMenu();
            setupAudioControls();
        };
    </script>
</body>
</html>
