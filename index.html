<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DESPERTAR ESTELAR: FUGA OU SALVAÇÃO</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
        }

        body {
            background-color: #000;
            color: #00ff00;
            overflow: hidden;
            touch-action: manipulation;
            height: 100vh;
            width: 100vw;
        }

        /* TELAS PRINCIPAIS */
        .screen {
            position: absolute;
            height: 100vh;
            width: 100vw;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 1s;
            padding: 20px;
            overflow: hidden;
        }

        .hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* TELA INICIAL */
        #start-screen {
            background-color: #000;
            z-index: 10;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .star {
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
            animation: twinkle 2s infinite;
        }

        @keyframes twinkle {
            0%, 100% {
                opacity: 0.5;
            }
            50% {
                opacity: 1;
            }
        }

        .title {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-align: center;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
            letter-spacing: 3px;
            animation: pulse 3s infinite;
            max-width: 90%;
        }

        @keyframes pulse {
            0%, 100% {
                text-shadow: 0 0 10px #00ff00;
            }
            50% {
                text-shadow: 0 0 20px #00ff00, 0 0 30px #00ff00;
            }
        }

        .start-button {
            padding: 15px 40px;
            font-size: 1.5rem;
            background-color: transparent;
            color: #00ff00;
            border: 2px solid #00ff00;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .start-button:hover, .start-button:active {
            background-color: #00ff00;
            color: #000;
            box-shadow: 0 0 20px #00ff00;
        }

        .space-ship {
            position: absolute;
            width: 100px;
            height: 50px;
            animation: flyAround 30s linear infinite;
            opacity: 0.7;
        }

        @keyframes flyAround {
            0% {
                transform: translate(-150px, 100px) rotate(30deg);
            }
            25% {
                transform: translate(calc(100vw + 50px), 30vh) rotate(-15deg);
            }
            50% {
                transform: translate(calc(100vw - 50px), calc(100vh - 100px)) rotate(-45deg);
            }
            75% {
                transform: translate(0, calc(100vh - 50px)) rotate(0deg);
            }
            100% {
                transform: translate(-150px, 100px) rotate(30deg);
            }
        }

        /* TELA DE INTRO (TEXTO ROLANDO) */
        #intro-screen {
            justify-content: flex-start;
            perspective: 400px;
        }

        .intro-text {
            transform-origin: center bottom;
            transform: rotateX(25deg) translateY(100vh);
            font-size: 1.8rem;
            line-height: 1.5;
            text-align: center;
            max-width: 80%;
            animation: scrollUp 10s linear forwards;
            animation-play-state: running;
            padding: 20px;
        }

        @keyframes scrollUp {
            from {
                transform: rotateX(25deg) translateY(100vh);
            }
            to {
                transform: rotateX(25deg) translateY(-300vh);
            }
        }

        /* TELA DE HISTÓRIA */
        #story-screen {
            justify-content: flex-start;
            overflow-y: auto;
        }

        .story-container {
            width: 100%;
            max-width: 800px;
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            padding: 20px;
            position: relative;
        }

        .story-text {
            font-size: 1.2rem;
            line-height: 1.5;
            margin-bottom: 2rem;
            text-align: justify;
            animation: fadeIn 2s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .story-id {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 1rem;
            color: #888;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: auto;
        }

        .option-button {
            padding: 15px;
            background-color: rgba(0, 50, 0, 0.7);
            color: #00ff00;
            border: 1px solid #00ff00;
            border-radius: 5px;
            cursor: pointer;
            text-align: left;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .option-button:hover, .option-button:active {
            background-color: rgba(0, 80, 0, 0.9);
            box-shadow: 0 0 10px #00ff00;
        }

        /* TELA DE COMBATE */
        #combat-screen {
            background-color: rgba(50, 0, 0, 0.8);
        }

        .combat-container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .combat-header {
            text-align: center;
            font-size: 1.5rem;
            color: #ff3333;
            margin-bottom: 20px;
        }

        .combat-area {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            margin-bottom: 20px;
        }

        .combat-character, .combat-enemy {
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid #666;
            border-radius: 10px;
            padding: 15px;
            width: 48%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .health-bar {
            width: 100%;
            height: 20px;
            background-color: #333;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .health-fill {
            height: 100%;
            background-color: #ff3333;
            width: 100%;
            transition: width 0.5s;
        }

        .combat-log {
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid #666;
            border-radius: 10px;
            padding: 10px;
            height: 150px;
            overflow-y: auto;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .combat-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .combat-button {
            padding: 10px 20px;
            background-color: rgba(100, 0, 0, 0.7);
            color: white;
            border: 1px solid #ff3333;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        .combat-button:hover, .combat-button:active {
            background-color: rgba(150, 0, 0, 0.9);
            box-shadow: 0 0 10px #ff3333;
        }

        /* TELA DE QUEBRA-CABEÇA */
        #puzzle-screen {
            background-color: rgba(0, 0, 50, 0.8);
        }

        .puzzle-container {
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .puzzle-header {
            text-align: center;
            font-size: 1.5rem;
            color: #33ccff;
            margin-bottom: 20px;
        }

        .puzzle-description {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #eee;
        }

        .puzzle-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }

        .puzzle-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .puzzle-button {
            padding: 15px 30px;
            background-color: rgba(0, 0, 100, 0.7);
            color: white;
            border: 1px solid #33ccff;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .puzzle-button:hover, .puzzle-button:active {
            background-color: rgba(0, 0, 150, 0.9);
            box-shadow: 0 0 10px #33ccff;
        }

        /* RESPONSIVIDADE */
        @media (max-width: 768px) {
            .title {
                font-size: 1.8rem;
            }
            
            .intro-text {
                font-size: 1.2rem;
            }
            
            .story-text {
                font-size: 1rem;
            }
            
            .combat-area {
                flex-direction: column;
            }
            
            .combat-character, .combat-enemy {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .title {
                font-size: 1.5rem;
            }
            
            .start-button {
                padding: 10px 30px;
                font-size: 1.2rem;
            }
            
            .intro-text {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- TELA INICIAL -->
    <div id="start-screen" class="screen">
        <div class="stars"></div>
        <div class="space-ship">
            <svg viewBox="0 0 100 50" xmlns="http://www.w3.org/2000/svg">
                <path d="M10,25 L40,10 L90,25 L40,40 Z" fill="#555" stroke="#888" stroke-width="2"/>
                <path d="M90,25 L95,20 L97,25 L95,30 Z" fill="#00ffff" stroke="#00ffff" stroke-width="1"/>
            </svg>
        </div>
        <h1 class="title">DESPERTAR ESTELAR:<br>FUGA OU SALVAÇÃO</h1>
        <button class="start-button" id="start-button">Iniciar</button>
    </div>

    <!-- TELA DE INTRODUÇÃO (TEXTO ROLANDO) -->
    <div id="intro-screen" class="screen hidden">
        <div class="intro-text" id="intro-text">
            <p>Em um futuro distante, onde a humanidade conquistou as estrelas...</p>
            <br>
            <p>A nave colonial Esperança viaja pelos confins do espaço, transportando 200 colonos em criossono para o sistema Kepler-62.</p>
            <br>
            <p>Sua missão: estabelecer a primeira colônia humana permanente fora do Sistema Solar.</p>
            <br>
            <p>O que deveria ser apenas mais um salto hiperespacial rotineiro se transforma em uma luta desesperada pela sobrevivência.</p>
            <br>
            <p>Quando algo dá terrivelmente errado...</p>
            <br>
            <p>Capitão Alex Reiner acorda em uma nave danificada, com sistemas falhando e um mistério mortal por resolver.</p>
            <br>
            <p>Salvar os colonos ou salvar a si mesmo?</p>
            <br>
            <p>A escolha está em suas mãos...</p>
        </div>
    </div>

    <!-- TELA DE HISTÓRIA -->
    <div id="story-screen" class="screen hidden">
        <div class="story-container" id="story-container">
            <span class="story-id" id="section-id"></span>
            <div class="story-text" id="story-text"></div>
            <div class="options-container" id="options-container"></div>
        </div>
    </div>

    <!-- TELA DE COMBATE -->
    <div id="combat-screen" class="screen hidden">
        <div class="combat-container">
            <h2 class="combat-header" id="combat-header">COMBATE</h2>
            <div class="combat-area">
                <div class="combat-character">
                    <h3 id="character-name">Capitão Reiner</h3>
                    <div class="health-bar">
                        <div class="health-fill" id="character-health"></div>
                    </div>
                    <div id="character-items">Arma: Pistola de Energia</div>
                </div>
                <div class="combat-enemy">
                    <h3 id="enemy-name">Inimigo</h3>
                    <div class="health-bar">
                        <div class="health-fill" id="enemy-health"></div>
                    </div>
                    <div id="enemy-info"></div>
                </div>
            </div>
            <div class="combat-log" id="combat-log">
                Prepare-se para o combate!
            </div>
            <div class="combat-actions" id="combat-actions">
                <!-- Botões serão adicionados via JavaScript -->
            </div>
        </div>
    </div>

    <!-- TELA DE QUEBRA-CABEÇA -->
    <div id="puzzle-screen" class="screen hidden">
        <div class="puzzle-container">
            <h2 class="puzzle-header" id="puzzle-header">QUEBRA-CABEÇA</h2>
            <p class="puzzle-description" id="puzzle-description"></p>
            <div class="puzzle-content" id="puzzle-content">
                <!-- Conteúdo do quebra-cabeça será adicionado via JavaScript -->
            </div>
            <div class="puzzle-options" id="puzzle-options">
                <!-- Opções serão adicionadas via JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // -------------------- CONFIGURAÇÕES DO JOGO --------------------
        const SCROLL_SPEED = 60; // Velocidade do texto rolando em segundos
        const TEXT_DELAY = 5; // Tempo de espera em segundos antes e depois do texto
        
        // -------------------- DADOS DO JOGO --------------------
        // Definição das seções da história
        const storyData = {
            "intro": {
                text: "Seus olhos se abrem com dificuldade, a visão turva tentando se adaptar à fraca iluminação vermelha de emergência. Sua cabeça lateja como se tivesse sido atingida por um meteoro. As memórias retornam aos poucos: você é o Capitão Alex Reiner da nave colonial Esperança, transportando 200 colonos em criossono para o sistema Kepler-62. O último salto hiperespacial deveria ter sido rotineiro, mas algo deu muito errado.\n\nO painel de controle à sua frente pisca com dezenas de alertas. Uma voz robótica anuncia friamente: \"Falha crítica no núcleo. Colapso estrutural em 120 minutos. Evacuação recomendada.\"\n\nVocê se levanta cambaleante da cadeira do piloto e percebe que está sozinho na ponte. A tripulação deveria estar aqui. Suas opções são limitadas e o tempo, precioso.\n\nO que você faz?",
                options: [
                    { text: "Verificar o sistema de diagnóstico para entender o que aconteceu.", nextSection: "10" },
                    { text: "Ir imediatamente ao setor de criogenia para verificar os passageiros.", nextSection: "20" },
                    { text: "Dirigir-se à sala de comunicações para enviar um pedido de socorro.", nextSection: "30" }
                ]
            },
            "10": {
                text: "O sistema de diagnóstico está parcialmente operacional. Seus dedos deslizam pelo painel holográfico enquanto você navega pelos relatórios técnicos. A situação é pior do que imaginava: durante o salto, uma anomalia quântica causou uma sobrecarga no núcleo de fusão. O sistema de contenção está falhando e o colapso é inevitável.\n\nAs câmeras de segurança mostram vários setores já comprometidos. O setor oeste está completamente lacrado devido à descompressão. No relatório da tripulação, descobre que dos 15 tripulantes, apenas 8 estão vivos, espalhados pela nave e alguns feridos. Os 200 colonos em criossono estão em risco crítico - o sistema de suporte vital está operando com energia de emergência.\n\nUm detalhe chama sua atenção: há apenas 2 cápsulas de escape operacionais, cada uma com capacidade para 50 pessoas.\n\nO que você faz?",
                options: [
                    { text: "Acessar o mapa da nave para planejar uma rota de resgate.", nextSection: "11" },
                    { text: "Verificar o sistema de comunicação interna para contatar sobreviventes.", nextSection: "12" },
                    { text: "Examinar o registro do salto para entender melhor a anomalia.", nextSection: "13" }
                ]
            },
            "11": {
                text: "O mapa holográfico da nave surge diante de você. A Esperança tem 5 níveis principais, com você atualmente na ponte (nível 1). O setor de criogenia está no nível 3, as cápsulas de escape no nível 5, e a sala do reator no nível 4.\n\nRotas diretas entre níveis estão bloqueadas em vários pontos. Será necessário um desvio pelo sistema de manutenção para alcançar qualquer setor crucial.\n\nEnquanto analisa as opções, uma nova mensagem aparece no sistema: \"Detectada atividade não autorizada no setor de segurança. Protocolo de quarentena ativado.\"\n\nIsso não estava no diagnóstico inicial. Alguém ou algo está mexendo nos sistemas de segurança.\n\nO que você faz?",
                options: [
                    { text: "Investigar a atividade suspeita no setor de segurança.", nextSection: "14" },
                    { text: "Ignorar o alerta e seguir para o setor de criogenia.", nextSection: "20" },
                    { text: "Ativar os protocolos de emergência que darão mais tempo antes do colapso.", nextSection: "15" }
                ]
            },
            "12": {
                text: "Você ativa o sistema de comunicação interna. \"Aqui é o Capitão Reiner. Alguém na escuta?\"\n\nApós alguns segundos de estática, uma voz feminina responde: \"Capitão? Graças a Deus! É Elena Vasquez, engenheira-chefe. Estou presa na sala de máquinas auxiliar com o Dr. Petrov. Ele está ferido.\"\n\nOutra voz corta a transmissão: \"Capitão, aqui é Tenente Rodriguez. Estou com três outros tripulantes no laboratório. Tentamos acessar o setor de criogenia, mas o sistema está em lockdown.\"\n\nUma terceira voz, distorcida e entrecortada: \"...sabotagem...não confie...eles querem...\" A transmissão é cortada abruptamente.\n\nO que você faz?",
                options: [
                    { text: "Pedir mais informações à Engenheira Vasquez.", nextSection: "16" },
                    { text: "Solicitar um relatório detalhado ao Tenente Rodriguez.", nextSection: "17" },
                    { text: "Tentar restaurar a última transmissão cortada.", nextSection: "18" }
                ]
            },
            "13": {
                text: "Os registros do salto são confusos. Algo interferiu com os cálculos quânticos no momento exato da transição. A assinatura energética não parece natural -- os padrões sugerem uma interferência deliberada.\n\nUma entrada do diário de bordo, datada de apenas 12 horas antes do salto, chama sua atenção. É do Oficial de Ciências, Dr. Yamamoto: \"Descobri algo preocupante nos dados de longa distância. Preciso falar com o Capitão imediatamente. Se minhas suspeitas estiverem corretas, não estamos sozinhos nesta missão.\"\n\nAo verificar os registros de acesso, você descobre que alguém entrou na sala de controle do salto três minutos antes da inicialização, usando as credenciais do Oficial de Segurança Chen.\n\nO que você faz?",
                options: [
                    { text: "Verificar as câmeras de segurança para ver quem entrou na sala de controle.", nextSection: "19" },
                    { text: "Procurar o Oficial de Segurança Chen pela nave.", nextSection: "21" },
                    { text: "Investigar o último local conhecido do Dr. Yamamoto.", nextSection: "22" }
                ]
            },
            "14": {
                text: "Você navega pelos corredores parcialmente iluminados em direção ao setor de segurança. A gravidade artificial oscila, fazendo com que às vezes seus passos sejam mais leves ou mais pesados.\n\nAo chegar ao setor de segurança, encontra a porta entreaberta. Dentro, vê um homem debruçado sobre o console principal. Ele não está usando uniforme da tripulação.\n\nAo perceber sua presença, ele se vira rapidamente. É um rosto que você não reconhece. \"Capitão,\" ele diz com um sorriso tenso. \"Que bom que está vivo. Estou tentando restaurar os protocolos de segurança.\"\n\nSeu instinto diz que algo está errado. Ele está usando um distintivo de autorização de nível superior que nem mesmo você possui.\n\nO que você faz?",
                options: [
                    { text: "Confrontá-lo diretamente sobre sua identidade.", nextSection: "23" },
                    { text: "Fingir que acredita nele e pedir mais informações.", nextSection: "24" },
                    { text: "Atacá-lo imediatamente, considerando-o uma ameaça.", nextSection: "25" }
                ]
            },
            "15": {
                text: "Você acessa os protocolos de emergência, redirecionando energia dos sistemas não essenciais para reforçar a contenção do núcleo. O sistema informa que isso pode dar à nave mais 30 minutos antes do colapso total.\n\nDurante o processo, você descobre uma sequência de comandos recentemente introduzida no sistema. Alguém programou o desligamento dos suportes de vida no setor de criogenia para daqui a 15 minutos.",
                options: [],
                type: "puzzle",
                puzzleData: {
                    title: "QUEBRA-CABEÇA: CÓDIGO DE SEGURANÇA",
                    description: "Para cancelar esta sequência, você precisa resolver o código de segurança. O sistema fornece a seguinte dica:\n\n\"Eu sou o que resta quando tudo falha. Meu primeiro dígito é o número de planetas habitáveis no sistema Kepler-62. Meu segundo dígito é o número de cápsulas de escape funcionais. Meu terceiro dígito é o número de níveis da nave Esperança. Meu último dígito é o valor de X na equação: 3X + 7 = 22.\"",
                    options: [
                        { text: "2255", nextSection: "26", correct: true },
                        { text: "2250", nextSection: "27", correct: false },
                        { text: "2505", nextSection: "28", correct: false }
                    ]
                }
            },
            "16": {
                text: "\"Capitão,\" a voz de Elena soa ansiosa, \"algo muito estranho aconteceu antes do salto. O Dr. Petrov detectou uma transmissão não autorizada saindo da nave, mas quando fomos investigar, houve uma explosão no corredor J. Petrov acha que foi deliberado.\"\n\n\"Conseguimos acessar brevemente os registros de segurança. Havia passageiros não listados embarcados em Marte. Três deles. Não estão nos registros oficiais.\"\n\nPetrov tosse ao fundo antes de falar: \"Capitão, suspeitamos que sejam agentes de Nova Terra. A colônia em Kepler-62 representa uma vantagem estratégica que eles não queriam que a Aliança obtivesse.\"\n\n\"Precisamos chegar até você,\" diz Elena, \"mas os corredores entre nós estão bloqueados. Há uma forma de nos ajudar a passar pelo sistema de manutenção?\"\n\nO que você faz?",
                options: [
                    { text: "Ajudar Elena e Petrov a navegar pelos dutos de manutenção.", nextSection: "29" },
                    { text: "Pedir que permaneçam onde estão enquanto você verifica a informação sobre os passageiros não listados.", nextSection: "31" },
                    { text: "Instruí-los a tentar alcançar as cápsulas de escape e encontrar você lá.", nextSection: "32" }
                ]
            },
            "17": {
                text: "\"Capitão,\" o Tenente Rodriguez responde com voz firme, \"a situação é crítica. Estou com os oficiais Kowalski, Takahashi e Lin. Tentamos acessar o setor de criogenia, mas alguém alterou os códigos de segurança.\"\n\n\"Descobrimos algo perturbador nos laboratórios. Os dados da missão foram alterados. As coordenadas do salto foram manipuladas para nos levar a este setor específico do espaço. Não foi um acidente.\"\n\n\"Takahashi identificou três assinaturas biométricas não registradas movendo-se pela nave pouco antes do salto. Suspeitamos que são sabotadores.\"\n\nEnquanto ele fala, você ouve um ruído metálico ao fundo, seguido por gritos. A comunicação fica cheia de estática. A última coisa que ouve é: \"Eles estão aqui! Corra para o--\" antes de ser cortada.\n\nO que você faz?",
                options: [
                    { text: "Tentar restabelecer contato com o grupo de Rodriguez.", nextSection: "33" },
                    { text: "Dirigir-se ao laboratório para verificar o que aconteceu.", nextSection: "34" },
                    { text: "Alertar Elena e Petrov sobre o possível perigo.", nextSection: "35" }
                ]
            },
            "18": {
                text: "Você utiliza ferramentas avançadas de análise de áudio para reconstruir a transmissão cortada. Depois de alguns ajustes, consegue recuperar parte da mensagem:\n\n\"...sabotagem confirmada. Não confie na Vasquez. Eles querem os dados do projeto Prometeu. Os passageiros são apenas disfarce. O verdadeiro objetivo é o módulo secreto. Capitão, você precisa acessar o compartimento 772B antes que eles destruam...\"\n\nA mensagem termina aí. Não há identificação de quem a enviou.\n\nVocê verifica rapidamente sua base de dados pessoal. O projeto Prometeu está classificado como ultra-secreto, algo que apenas capitães de alto escalão deveriam conhecer. Envolve tecnologia de terraformação revolucionária.\n\nO compartimento 772B não aparece em nenhum mapa oficial da nave.\n\nO que você faz?",
                options: [
                    { text: "Confrontar Elena Vasquez sobre a mensagem.", nextSection: "36" },
                    { text: "Procurar o misterioso compartimento 772B.", nextSection: "37" },
                    { text: "Ignorar a mensagem, considerando-a uma possível armadilha.", nextSection: "38" }
                ]
            },
            "19": {
                text: "As gravações de segurança mostram uma figura encapuzada entrando na sala de controle do salto. A pessoa move-se com precisão, conhecendo exatamente para onde ir. Ela insere um dispositivo no console principal, digita uma sequência de comandos e sai rapidamente.\n\nO ângulo da câmera não permite ver o rosto, mas você nota um detalhe perturbador: a pessoa usa um bracelete médico idêntico ao da Dra. Yasmin Khoury, a médica-chefe da nave.\n\nConsultando o sistema de localização da tripulação, você descobre que o último registro da Dra. Khoury a coloca no laboratório médico, aproximadamente 20 minutos antes do salto. Não há registros após isso.\n\nO que você faz?",
                options: [
                    { text: "Ir ao laboratório médico investigar o paradeiro da Dra. Khoury.", nextSection: "39" },
                    { text: "Alertar os sobreviventes sobre uma possível impostora.", nextSection: "40" },
                    { text: "Verificar as credenciais e histórico da Dra. Khoury no banco de dados da nave.", nextSection: "41" }
                ]
            },
            "20": {
                text: "O caminho para o setor de criogenia é mais difícil do que esperava. Portas de emergência bloqueiam as rotas principais, forçando-o a navegar por corredores de manutenção estreitos e mal iluminados.\n\nAo chegar à entrada do setor de criogenia, você encontra a porta principal selada. O painel de acesso está danificado, mas ainda funcional. Para abri-lo, precisará resolver um quebra-cabeça de roteamento de energia.",
                options: [],
                type: "puzzle",
                puzzleData: {
                    title: "QUEBRA-CABEÇA: ROTEAMENTO DE ENERGIA",
                    description: "O painel mostra um diagrama com 5 nós de energia (A, B, C, D, E) e 6 caminhos possíveis. Você precisa fazer a energia fluir da fonte ao destino sem sobrecarregar nenhum nó. Cada nó pode suportar apenas duas conexões ativas.",
                    options: [
                        { text: "Conectar A-B-E-D", nextSection: "42", correct: false },
                        { text: "Conectar A-C-B-D", nextSection: "43", correct: true },
                        { text: "Conectar A-C-E-D", nextSection: "44", correct: false }
                    ]
                }
            },
            "21": {
                text: "Você consulta o sistema de localização para encontrar o Oficial Chen. Seu último registro o coloca no Armamento, duas horas antes do salto. Nenhuma atividade desde então.\n\nO caminho para o Armamento está parcialmente bloqueado por destroços. Você navega com dificuldade, passando por corredores que mostram sinais claros de luta - marcas de tiros nas paredes, manchas de sangue no chão.\n\nAo chegar ao Armamento, encontra a porta arrombada. Dentro, o corpo do Oficial Chen está caído próximo ao arsenal. A maioria das armas desapareceu. Ele tem um mensageiro pessoal na mão, travado com segurança biométrica.\n\nO que você faz?",
                options: [
                    { text: "Tentar desbloquear o mensageiro usando o reconhecimento biométrico de Chen.", nextSection: "45" },
                    { text: "Procurar outras pistas no Armamento.", nextSection: "46" },
                    { text: "Pegar qualquer arma restante e continuar sua missão.", nextSection: "47" }
                ]
            },
            "22": {
                text: "O laboratório do Dr. Yamamoto está localizado no nível 2, próximo aos observatórios. Você segue por corredores cada vez mais escuros, com a energia falhando em seções inteiras.\n\nA porta do laboratório está entreaberta. Dentro, encontra um caos de equipamentos quebrados e papéis espalhados. Houve claramente uma busca violenta.\n\nNo centro da sala, um holograma está pausado, mostrando uma estranha estrutura orbital próxima ao ponto de saída do salto hiperespacial. Parece artificial, definitivamente não natural.\n\nNo terminal principal, protegido por uma sequência de segurança, há um arquivo marcado como \"URGENTE - CAPITÃO\".",
                options: [],
                type: "puzzle",
                puzzleData: {
                    title: "QUEBRA-CABEÇA: SEQUÊNCIA NUMÉRICA",
                    description: "Para acessar o arquivo, você precisa resolver a sequência:\n8, 27, ?, 125, 216\n\nQual número falta?",
                    options: [
                        { text: "64", nextSection: "48", correct: true },
                        { text: "36", nextSection: "49", correct: false },
                        { text: "81", nextSection: "50", correct: false }
                    ]
                }
            },
            "23": {
                text: "\"Quem é você realmente?\" você pergunta, mantendo distância. \"Esse distintivo não está autorizado nem mesmo para mim.\"\n\nO homem congela por um momento, então seu comportamento muda completamente. Ele se endireita e sorri com confiança.\n\n\"Perspicaz, Capitão. Teria sido mais fácil se você simplesmente corresse para as cápsulas como previsto.\" Ele não parece preocupado com sua presença. \"Meu nome não importa. Represento pessoas que têm grande interesse no que esta nave transporta.\"\n\n\"O salto foi apenas parcialmente sabotado. Não queríamos destruir a nave, apenas desviá-la para este setor para que meus associados pudessem recuperar o módulo Prometeu. Os colonos são apenas... cobertura conveniente.\"\n\nEle saca uma arma. \"Agora, temos aproximadamente 90 minutos antes que esta nave se desintegre. Você pode cooperar e me levar ao compartimento 772B, ou posso encontrá-lo sozinho depois de eliminar você.\"\n\nO que você faz?",
                options: [
                    { text: "Tentar negociar para ganhar tempo.", nextSection: "51" },
                    { text: "Atacar imediatamente, aproveitando sua proximidade.", nextSection: "52" },
                    { text: "Fingir cooperação para descobrir mais sobre seus planos.", nextSection: "53" }
                ]
            },
            "24": {
                text: "\"Entendo,\" você diz, tentando parecer aliviado. \"Que bom que alguém está trabalhando nisso. Qual é a situação atual dos sistemas?\"\n\nO homem parece relaxar um pouco, voltando sua atenção ao console. \"Estou tentando restabelecer o controle após o... incidente. Alguns membros da tripulação estão complicando as coisas. Especialmente aqueles no laboratório.\"\n\nEnquanto ele fala, você nota algo estranho - ele está inserindo comandos para desativar os sistemas de suporte vital em várias seções da nave.\n\n\"O Diretor ficará satisfeito por você ter sobrevivido, Capitão,\" ele continua. \"Quase pensamos que tínhamos perdido você junto com os outros na ponte.\"\n\nVocê não estava sozinho na ponte quando acordou? E qual diretor?\n\nO que você faz?",
                options: [
                    { text: "Continuar o disfarce, tentando obter mais informações.", nextSection: "54" },
                    { text: "Procurar uma arma ou objeto para neutralizá-lo.", nextSection: "55" },
                    { text: "Ativar discretamente o alarme de segurança no seu comunicador.", nextSection: "56" }
                ]
            },
            "25": {
                type: "combat",
                text: "Sem hesitar, você avança contra o desconhecido. O elemento surpresa funciona a seu favor - ele não espera um ataque frontal.",
                combatData: {
                    enemyName: "Sabotador Desconhecido",
                    enemyInfo: "Armado com pistola de energia",
                    playerHealth: 100,
                    enemyHealth: 80,
                    playerItems: ["Ferramenta de reparo", "Comunicador de emergência", "Kit médico básico"],
                    outcomes: [
                        { result: "victory", nextSection: "57" },
                        { result: "defeat", nextSection: "58" }
                    ]
                }
            },
            "26": {
                text: "Você insere o código 2255. O painel acende verde: \"Código correto. Sequência cancelada. Sistemas de suporte vital no setor de criogenia estabilizados.\"\n\nVocê suspira aliviado. Os colonos estão temporariamente seguros, mas o tempo continua correndo para o colapso do núcleo.\n\nEnquanto avalia suas próximas opções, uma nova mensagem surge no console: \"Transmissão recebida. Origem: desconhecida.\"\n\nAo abrir a mensagem, você vê coordenadas espaciais e uma mensagem críptica: \"A Prometeu está comprometida. Rendezvous em Delta-9. Elimine testemunhas.\"\n\nA mensagem claramente não era destinada a você.\n\nO que você faz?",
                options: [
                    { text: "Rastrear a origem da transmissão.", nextSection: "60" },
                    { text: "Investigar o que é \"Prometeu\" nos bancos de dados da nave.", nextSection: "61" },
                    { text: "Ignorar a mensagem e seguir para o setor de criogenia.", nextSection: "62" }
                ]
            },
            "27": {
                text: "Você insere o código 2250. O sistema pisca vermelho: \"Código incorreto. Uma tentativa restante.\"\n\nReanalisando o quebra-cabeça com atenção: o sistema Kepler-62 tem 2 planetas habitáveis confirmados, existem 2 cápsulas de escape funcionais, a nave tem 5 níveis, e resolvendo 3X + 7 = 22, temos X = 5.\n\nSua última chance:",
                options: [
                    { text: "Inserir o código 2255.", nextSection: "26" },
                    { text: "Inserir o código 2505.", nextSection: "28" }
                ]
            },
            "28": {
                text: "Você insere o código 2505. O sistema pisca vermelho: \"Código incorreto. Acesso bloqueado. Alerta enviado à segurança.\"\n\nVocê tenta contornar o bloqueio, mas sem sucesso. Agora está preso, e o tempo está acabando. Você precisará encontrar outra forma de salvar os colonos.\n\nEnquanto pondera suas opções, ouve passos se aproximando pelo corredor. Alguém vem verificar o alerta de segurança.\n\nO que você faz?",
                options: [
                    { text: "Esconder-se e observar quem vem investigar.", nextSection: "63" },
                    { text: "Preparar-se para confrontar quem vier.", nextSection: "64" },
                    { text: "Fugir e buscar outro caminho para o setor de criogenia.", nextSection: "65" }
                ]
            },
            "29": {
                text: "Você acessa o sistema de manutenção e estabelece comunicação com Elena e Petrov. Usando o mapa da nave, você os guia através dos dutos de serviço.\n\n\"Há uma passagem de manutenção a dez metros à sua direita,\" você instrui. \"Isso levará vocês ao elevador de carga secundário, que ainda está operacional.\"\n\nEnquanto os guia, Elena compartilha mais informações: \"Antes do salto, interceptamos uma transmissão codificada. Petrov conseguiu decifrar parte dela - mencionava algo chamado 'Projeto Prometeu' e um 'módulo de contenção'. Você sabe do que se trata, Capitão?\"\n\nAntes que você possa responder, ouve sons de luta e gritos. A comunicação fica fragmentada.\n\nElena: \"Eles nos encontraram! São--\" A transmissão é cortada.\n\nO que você faz?",
                options: [
                    { text: "Tentar restabelecer contato com Elena e Petrov.", nextSection: "66" },
                    { text: "Dirigir-se ao local onde estavam para ajudá-los.", nextSection: "67" },
                    { text: "Continuar sua missão, presumindo que foram capturados.", nextSection: "68" }
                ]
            },
            "43": {
                text: "Você conecta A-C-B-D. O painel acende verde e a porta se abre com um silvo hidráulico. \"Acesso concedido ao setor de criogenia.\"\n\nAo entrar, você se depara com um vasto salão onde 200 cápsulas de criossono estão alinhadas em fileiras organizadas. Luzes de status piscam em várias delas - nem todas em verde.\n\nUm rápido diagnóstico confirma seu temor: 30 cápsulas estão em estado crítico, com falhas nos sistemas de suporte vital. Em aproximadamente 25 minutos, esses colonos começarão a sofrer danos cerebrais irreversíveis.\n\nNo centro da sala, você encontra dois tripulantes - o Oficial Médico Rivera e a Técnica de Sistemas Zhang. Eles parecem aliviados ao vê-lo.\n\n\"Capitão!\" exclama Rivera. \"Graças a Deus. Estamos tentando estabilizar as cápsulas críticas, mas o sistema principal está bloqueado.\"\n\nO que você faz?",
                options: [
                    { text: "Ajudar Rivera e Zhang a estabilizar as cápsulas críticas.", nextSection: "102" },
                    { text: "Questionar Rivera e Zhang sobre o que aconteceu durante o salto.", nextSection: "103" },
                    { text: "Informá-los sobre a sabotagem e pedir que ajudem na evacuação.", nextSection: "104" }
                ]
            },
            "48": {
                text: "Você insere \"64\" e o terminal acende em verde. \"Acesso concedido.\"\n\nO arquivo se abre, revelando um relatório urgente do Dr. Yamamoto, acompanhado de imagens e dados:\n\n\"Capitão, se estiver lendo isto, é porque minhas suspeitas se confirmaram. A anomalia que detectei não é natural - é uma estação de interceptação camuflada. Alguém sabia nossa rota e preparou uma armadilha.\n\nMais perturbador ainda é que o sinal emitido pela estação contém códigos que apenas pessoal da Aliança conheceria. Isso significa que temos um ou mais traidores a bordo.\n\nO verdadeiro propósito desta missão não é colonização. A nave transporta um dispositivo experimental de terraformação chamado 'Módulo Prometeu' no compartimento secreto 772B. Apenas o comando de alto escalão da Aliança sabe disso.\n\nSuspeito que o ataque iminente seja para roubar esta tecnologia. Se eu estiver correto, nosso salto será sabotado para nos desviar para o setor Delta-9, onde seremos abordados.\n\nTransferi a localização exata do módulo e o código de ativação para meu datapad pessoal. Encontre-o e proteja o módulo a todo custo. Se cair em mãos erradas, pode se tornar uma arma devastadora.\"\n\nJunto ao arquivo há uma imagem do compartimento 772B e sua localização precisa na nave.\n\nO que você faz?",
                options: [
                    { text: "Procurar o datapad do Dr. Yamamoto.", nextSection: "69" },
                    { text: "Ir diretamente ao compartimento 772B.", nextSection: "70" },
                    { text: "Alertar outros sobreviventes sobre a verdadeira natureza da missão.", nextSection: "71" }
                ]
            },
            "52": {
                type: "combat",
                text: "Você decide atacar antes que ele possa usar a arma. Lançando-se para frente, tenta desarmá-lo em um movimento rápido.",
                combatData: {
                    enemyName: "Agente Infiltrado",
                    enemyInfo: "Treinamento avançado em combate",
                    playerHealth: 100,
                    enemyHealth: 90,
                    playerItems: ["Canivete de emergência", "Fragmento metálico", "Cilindro de oxigênio portátil"],
                    outcomes: [
                        { result: "victory", nextSection: "72" },
                        { result: "defeat", nextSection: "73" }
                    ]
                }
            },
            "57": {
                text: "Vocês lutam ferozmente. Ele é forte e treinado, mas você tem a vantagem inicial. Durante a luta, uma pistola de energia cai de seu coldre. Você consegue afastá-lo o suficiente para alcançar a arma.\n\nApontando para ele, você exige respostas. O homem ri, apesar da situação. \"Atire se quiser, Capitão. Meus companheiros já estão acessando o módulo. Esta nave está condenada de qualquer forma.\"\n\nVocê nocauteia o homem com a coronha da arma e o amarra firmemente usando cabos de emergência. Ele pode ter informações valiosas quando acordar.\n\nUm alarme soa de repente, e a voz robótica anuncia: \"Alerta. Violação de segurança no nível 5. Acesso não autorizado às cápsulas de escape.\"\n\nO que você faz?",
                options: [
                    { text: "Ir imediatamente para o nível 5 para verificar as cápsulas de escape.", nextSection: "74" },
                    { text: "Procurar o compartimento 772B mencionado pelo infiltrado.", nextSection: "75" },
                    { text: "Acordar o homem e forçá-lo a revelar mais informações.", nextSection: "76" }
                ]
            },
            // Mais seções da história seriam adicionadas aqui...
            "final": {
                text: "À medida que você pilota a nave de fuga através dos destroços da Esperança, olha pela janela uma última vez. A enorme estrutura que foi seu lar por tanto tempo agora se desintegra em uma explosão silenciosa no vácuo do espaço.\n\nNa cabine atrás de você, os sobreviventes que conseguiu resgatar - uma mistura de tripulantes e colonos despertados - observam em silêncio. Alguns choram, outros simplesmente encaram o vazio, processando o trauma e a perda.\n\nO módulo Prometeu está seguro, seja para ser destruído ou entregue às autoridades adequadas, dependendo das escolhas que você fez. A verdade sobre a sabotagem e os impostores veio à tona, embora a um custo terrível.\n\nNo painel de navegação, as coordenadas da estação mais próxima piscam - está a três semanas de distância no espaço normal. Uma viagem longa com recursos limitados, mas há esperança.\n\nEnquanto a nave acelera para longe dos destroços, você reflete sobre as decisões que tomou, as vidas que conseguiu salvar e aquelas que teve que deixar para trás. Algumas escolhas o assombrarão para sempre, outras trarão um senso de dever cumprido.\n\nUma coisa é certa: nada será como antes. E enquanto as estrelas se estendem infinitas à sua frente, você se pergunta o que o futuro reserva para os sobreviventes da Esperança.\n\nFIM DA AVENTURA",
                options: [
                    { text: "Jogar novamente", nextSection: "intro" }
                ]
            }
        };

        // -------------------- ITENS DO JOGO (ALEATÓRIOS) --------------------
        const randomWeapons = [
            "Pistola de Plasma", 
            "Rifle de Pulso", 
            "Lança-Dardos Tranquilizantes", 
            "Bastão de Choque", 
            "Canhão Sônico", 
            "Lâmina Vibratória", 
            "Projector de Campo de Força"
        ];
        
        const randomItems = [
            "Kit Médico Avançado", 
            "Injetor de Adrenalina", 
            "Escudo Pessoal", 
            "Módulo de Camuflagem", 
            "Granada de Choque", 
            "Ferramenta Multiuso", 
            "Hacker Portátil", 
            "Oxigênio de Emergência", 
            "Estimulante Neural", 
            "Bateria de Energia"
        ];
        
        const randomEnemies = [
            "Agente de Nova Terra", 
            "Sabotador Infiltrado", 
            "Segurança Corrompido", 
            "Mercenário Contratado", 
            "Drone de Combate", 
            "Tripulante Controlado", 
            "Caçador de Recompensas"
        ];

        // -------------------- VARIÁVEIS GLOBAIS --------------------
        let currentSection = "intro";
        let introAnimationPaused = false;
        let textScrollTimeout;
        
        // -------------------- FUNÇÕES DE UTILITÁRIO --------------------
        function getRandomItem(array) {
            return array[Math.floor(Math.random() * array.length)];
        }
        
        function showScreen(screenId) {
            // Esconder todas as telas
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            // Mostrar a tela solicitada
            document.getElementById(screenId).classList.remove('hidden');
        }
        
        // -------------------- GERADORES DE ESTRLAS E NAVE --------------------
        function generateStars() {
            const starsContainer = document.querySelector('.stars');
            const numberOfStars = 200;
            
            for (let i = 0; i < numberOfStars; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                star.style.width = `${Math.random() * 3}px`;
                star.style.height = star.style.width;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 2}s`;
                starsContainer.appendChild(star);
            }
        }
        
        // -------------------- HANDLERS DA TELA INICIAL --------------------
        function setupStartScreen() {
            document.getElementById('start-button').addEventListener('click', function() {
                showScreen('intro-screen');
                startIntroAnimation();
            });
            
            generateStars();
        }
        
        // -------------------- HANDLERS DA ANIMAÇÃO INTRODUTÓRIA --------------------
        function startIntroAnimation() {
            const introText = document.getElementById('intro-text');
            
            // Configurar a duração da animação baseada no SCROLL_SPEED
            introText.style.animation = `scrollUp ${SCROLL_SPEED}s linear forwards`;
            
            // Pausa o texto quando tocado/clicado
            introText.addEventListener('mousedown', pauseIntroText);
            introText.addEventListener('touchstart', pauseIntroText, { passive: true });
            
            // Continua o texto quando solto
            document.addEventListener('mouseup', resumeIntroText);
            document.addEventListener('touchend', resumeIntroText);
            
            // Tempo para transição para a história
            textScrollTimeout = setTimeout(() => {
                showScreen('story-screen');
                loadSection('intro');
            }, (SCROLL_SPEED + TEXT_DELAY * 2) * 500);
        }
        
        function pauseIntroText() {
            if (!introAnimationPaused) {
                document.getElementById('intro-text').style.animationPlayState = 'paused';
                introAnimationPaused = true;
                
                // Pausar também o timeout para a próxima tela
                clearTimeout(textScrollTimeout);
            }
        }
        
        function resumeIntroText() {
            if (introAnimationPaused) {
                const introText = document.getElementById('intro-text');
                introText.style.animationPlayState = 'running';
                introAnimationPaused = false;
                
                // Recalcular o tempo restante e redefinir o timeout
                const elapsedTime = getComputedStyle(introText).animationDelay;
                const totalDuration = (SCROLL_SPEED + TEXT_DELAY * 2) * 1000;
                const remainingTime = totalDuration - parseFloat(elapsedTime) * 1000;
                
                textScrollTimeout = setTimeout(() => {
                    showScreen('story-screen');
                    loadSection('intro');
                }, remainingTime);
            }
        }
        
        // -------------------- HANDLERS DA HISTÓRIA --------------------
        function loadSection(sectionId) {
            currentSection = sectionId;
            const section = storyData[sectionId];
            
            if (!section) {
                console.error(`Seção ${sectionId} não encontrada!`);
                return;
            }
            
            // Verificar se é uma seção especial (combate ou quebra-cabeça)
            if (section.type === 'combat') {
                setupCombat(section);
                return;
            } else if (section.type === 'puzzle') {
                setupPuzzle(section);
                return;
            }
            
            // Seção normal de história
            document.getElementById('section-id').textContent = `Seção ${sectionId}`;
            document.getElementById('story-text').innerHTML = section.text.replace(/\n/g, '<br>');
            
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            
            section.options.forEach(option => {
                const button = document.createElement('button');
                button.classList.add('option-button');
                button.textContent = option.text;
                button.addEventListener('click', () => loadSection(option.nextSection));
                optionsContainer.appendChild(button);
            });
            
            showScreen('story-screen');
        }
        
        // -------------------- HANDLERS DE COMBATE --------------------
        function setupCombat(section) {
            const combat = section.combatData;
            
            // Configurar detalhes do combate
            document.getElementById('combat-header').textContent = "COMBATE";
            document.getElementById('enemy-name').textContent = combat.enemyName;
            document.getElementById('enemy-info').textContent = combat.enemyInfo;
            
            // Restaurar saúde
            document.getElementById('character-health').style.width = '100%';
            document.getElementById('enemy-health').style.width = '100%';
            
            // Itens aleatórios do jogador
            const randomPlayerItems = [];
            for (let i = 0; i < 3; i++) {
                randomPlayerItems.push(getRandomItem(randomItems));
            }
            
            document.getElementById('character-items').innerHTML = `Arma: ${getRandomItem(randomWeapons)}<br>Itens: ${randomPlayerItems.join(', ')}`;
            
            // Configurar botões de ação
            const actionsContainer = document.getElementById('combat-actions');
            actionsContainer.innerHTML = '';
            
            const actions = [
                { text: "Atacar", action: "attack" },
                { text: "Defender", action: "defend" },
                { text: `Usar ${randomPlayerItems[0]}`, action: "useItem1" },
                { text: `Usar ${randomPlayerItems[1]}`, action: "useItem2" },
                { text: `Usar ${randomPlayerItems[2]}`, action: "useItem3" }
            ];
            
            actions.forEach(action => {
                const button = document.createElement('button');
                button.classList.add('combat-button');
                button.textContent = action.text;
                button.addEventListener('click', () => performCombatAction(action.action, combat));
                actionsContainer.appendChild(button);
            });
            
            // Mostrar tela de combate
            showScreen('combat-screen');
            
            // Texto inicial do combate
            document.getElementById('combat-log').innerHTML = section.text + '<br>Prepare-se para o combate!';
        }
        
        function performCombatAction(action, combat) {
            const log = document.getElementById('combat-log');
            const characterHealth = document.getElementById('character-health');
            const enemyHealth = document.getElementById('enemy-health');
            
            // Valores atuais de saúde
            let playerHealthValue = parseInt(characterHealth.style.width) || 100;
            let enemyHealthValue = parseInt(enemyHealth.style.width) || 100;
            
            let actionResult = '';
            let playerDamage = 0;
            let enemyDamage = 0;
            
            // Processar a ação do jogador
            switch(action) {
                case 'attack':
                    playerDamage = Math.floor(Math.random() * 30) + 10;
                    actionResult = `Você ataca o ${combat.enemyName}, causando ${playerDamage} de dano!`;
                    break;
                case 'defend':
                    actionResult = 'Você assume uma postura defensiva, reduzindo o dano recebido.';
                    break;
                case 'useItem1':
                case 'useItem2':
                case 'useItem3':
                    // Efeitos aleatórios para os itens
                    const effectType = Math.floor(Math.random() * 3);
                    if (effectType === 0) {
                        playerDamage = Math.floor(Math.random() * 40) + 20;
                        actionResult = `Você usa o item e causa ${playerDamage} de dano!`;
                    } else if (effectType === 1) {
                        playerHealthValue = Math.min(100, playerHealthValue + Math.floor(Math.random() * 30) + 10);
                        actionResult = 'Você usa o item para recuperar sua saúde!';
                    } else {
                        playerDamage = Math.floor(Math.random() * 20) + 5;
                        enemyDamage = Math.floor(Math.random() * 15) + 5;
                        actionResult = `Você usa o item causando ${playerDamage} de dano, mas sofre ${enemyDamage} de dano como efeito colateral!`;
                    }
                    break;
            }
            
            // Aplicar dano ao inimigo
            enemyHealthValue = Math.max(0, enemyHealthValue - playerDamage);
            enemyHealth.style.width = `${enemyHealthValue}%`;
            
            // Ação do inimigo (se ainda estiver vivo)
            if (enemyHealthValue > 0 && action !== 'defend') {
                const enemyAttackDamage = Math.floor(Math.random() * 25) + 5;
                playerHealthValue = Math.max(0, playerHealthValue - enemyAttackDamage);
                actionResult += `<br>${combat.enemyName} contra-ataca, causando ${enemyAttackDamage} de dano!`;
            } else if (enemyHealthValue > 0 && action === 'defend') {
                const reducedDamage = Math.floor(Math.random() * 15) + 1;
                playerHealthValue = Math.max(0, playerHealthValue - reducedDamage);
                actionResult += `<br>${combat.enemyName} ataca, mas sua defesa reduz o dano para ${reducedDamage}!`;
            }
            
            // Aplicar dano adicional ao jogador (de efeitos colaterais)
            playerHealthValue = Math.max(0, playerHealthValue - enemyDamage);
            characterHealth.style.width = `${playerHealthValue}%`;
            
            // Atualizar log de combate
            log.innerHTML += '<br>' + actionResult;
            log.scrollTop = log.scrollHeight;
            
            // Verificar fim do combate
            if (enemyHealthValue <= 0 || playerHealthValue <= 0) {
                const result = enemyHealthValue <= 0 ? 'victory' : 'defeat';
                const nextSection = combat.outcomes.find(outcome => outcome.result === result)?.nextSection || 'final';
                
                setTimeout(() => {
                    if (result === 'victory') {
                        log.innerHTML += '<br><br>Você derrotou o inimigo!';
                    } else {
                        log.innerHTML += '<br><br>Você foi derrotado!';
                    }
                    
                    setTimeout(() => loadSection(nextSection), 2000);
                }, 1000);
                
                // Desabilitar botões
                document.querySelectorAll('.combat-button').forEach(button => {
                    button.disabled = true;
                });
            }
        }
        
        // -------------------- HANDLERS DE QUEBRA-CABEÇA --------------------
        function setupPuzzle(section) {
            const puzzle = section.puzzleData;
            
            document.getElementById('puzzle-header').textContent = puzzle.title;
            document.getElementById('puzzle-description').innerHTML = puzzle.description.replace(/\n/g, '<br>');
            
            const puzzleContent = document.getElementById('puzzle-content');
            puzzleContent.innerHTML = '';
            
            // Adicionar conteúdo específico do quebra-cabeça aqui, se necessário
            
            const puzzleOptions = document.getElementById('puzzle-options');
            puzzleOptions.innerHTML = '';
            
            puzzle.options.forEach(option => {
                const button = document.createElement('button');
                button.classList.add('puzzle-button');
                button.textContent = option.text;
                button.addEventListener('click', () => {
                    loadSection(option.nextSection);
                });
                puzzleOptions.appendChild(button);
            });
            
            showScreen('puzzle-screen');
        }
        
        // -------------------- INICIALIZAÇÃO --------------------
        window.onload = function() {
            setupStartScreen();
        };
    </script>
</body>
</html>
